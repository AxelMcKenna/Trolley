const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/maplibre-gl-FinJO4c9.js","assets/index-Coi2vgDx.js","assets/index-Cwl2_Emc.css"])))=>i.map(i=>d[i]);
import{r as f,d as wt,_ as bt,j as g}from"./index-Coi2vgDx.js";import{a as nt,C as ot}from"./chainConstants-L7boZneU.js";import{x as st,y as St}from"./index-DrjjgTOJ.js";import{f as rt,M as Lt}from"./productParams-DSKcz1WG.js";import{N as Tt}from"./navigation-Go8l6rJM.js";const At=f.createContext(null);function Rt(e,t){const n=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0,s=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0;return n===s&&o===r}function b(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!b(e[n],t[n]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!b(e[s],t[s]))return!1;return!0}return!1}function Pt(e){const t=e.clone();return t.pixelsToGLUnits=e.pixelsToGLUnits,t}function it(e,t){if(!e.getProjection)return;const n=e.getProjection(),o=t.getProjection();b(n,o)||t.setProjection(n)}function at(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function ct(e,t){const n=t.viewState||t;let o=!1;if("zoom"in n){const s=e.zoom;e.zoom=n.zoom,o=o||s!==e.zoom}if("bearing"in n){const s=e.bearing;e.bearing=n.bearing,o=o||s!==e.bearing}if("pitch"in n){const s=e.pitch;e.pitch=n.pitch,o=o||s!==e.pitch}if(n.padding&&!e.isPaddingEqual(n.padding)&&(o=!0,e.padding=n.padding),"longitude"in n&&"latitude"in n){const s=e.center;e.center=new s.constructor(n.longitude,n.latitude),o=o||s!==e.center}return o}const jt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function lt(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const t={};for(const o of e.layers)t[o.id]=o;const n=e.layers.map(o=>{let s=null;"interactive"in o&&(s=Object.assign({},o),delete s.interactive);const r=t[o.ref];if(r){s=s||Object.assign({},o),delete s.ref;for(const i of jt)i in r&&(s[i]=r[i])}return s||o});return{...e,layers:n}}var ut={};const dt={version:8,sources:{},layers:[]},ft={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},W={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},ht={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},kt=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Nt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class N{constructor(t,n,o){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const r=this.props[ht[s.type]];r?r(s):s.type==="error"&&console.error(s.error)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const r=this.props[ft[s.type]];r&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),r(s),delete s.features)},this._onCameraEvent=s=>{if(!this._internalUpdate){const r=this.props[W[s.type]];r&&r(s)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=t,this.props=n,this._initialize(o)}get map(){return this._map}get transform(){return this._renderTransform}setProps(t){const n=this.props;this.props=t;const o=this._updateSettings(t,n);o&&this._createShadowTransform(this._map);const s=this._updateSize(t),r=this._updateViewState(t,!0);this._updateStyle(t,n),this._updateStyleComponents(t,n),this._updateHandlers(t,n),(o||s||r&&!this._map.isMoving())&&this.redraw()}static reuse(t,n){const o=N.savedMaps.pop();if(!o)return null;const s=o.map,r=s.getContainer();for(n.className=r.className;r.childNodes.length>0;)n.appendChild(r.childNodes[0]);s._container=n;const i=s._resizeObserver;i&&(i.disconnect(),i.observe(n)),o.setProps({...t,styleDiffing:!1}),s.resize();const{initialViewState:c}=t;return c&&(c.bounds?s.fitBounds(c.bounds,{...c.fitBoundsOptions,duration:0}):o._updateViewState(c,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),s._update(),o}_initialize(t){const{props:n}=this,{mapStyle:o=dt}=n,s={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||Ot()||null,container:t,style:lt(o)},r=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const i=new this._MapClass(s);r.padding&&i.setPadding(r.padding),n.cursor&&(i.getCanvas().style.cursor=n.cursor),this._createShadowTransform(i);const c=i._render;i._render=u=>{this._inRender=!0,c.call(i,u),this._inRender=!1};const a=i._renderTaskQueue.run;i._renderTaskQueue.run=u=>{a.call(i._renderTaskQueue,u),this._onBeforeRepaint()},i.on("render",()=>this._onAfterRepaint());const l=i.fire;i.fire=this._fireEvent.bind(this,l),i.on("resize",()=>{this._renderTransform.resize(i.transform.width,i.transform.height)}),i.on("styledata",()=>{this._updateStyleComponents(this.props,{}),it(i.transform,this._renderTransform)}),i.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in ft)i.on(u,this._onPointerEvent);for(const u in W)i.on(u,this._onCameraEvent);for(const u in ht)i.on(u,this._onEvent);this._map=i}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),N.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createShadowTransform(t){const n=Pt(t.transform);t.painter.transform=n,this._renderTransform=n}_updateSize(t){const{viewState:n}=t;if(n){const o=this._map;if(n.width!==o.transform.width||n.height!==o.transform.height)return o.resize(),!0}return!1}_updateViewState(t,n){if(this._internalUpdate)return!1;const o=this._map,s=this._renderTransform,{zoom:r,pitch:i,bearing:c}=s,a=o.isMoving();a&&(s.cameraElevationReference="sea");const l=ct(s,{...at(o.transform),...t});if(a&&(s.cameraElevationReference="ground"),l&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=r!==s.zoom),u.rotate||(u.rotate=c!==s.bearing),u.pitch||(u.pitch=i!==s.pitch)}return a||ct(o.transform,t),l}_updateSettings(t,n){const o=this._map;let s=!1;for(const r of kt)if(r in t&&!b(t[r],n[r])){s=!0;const i=o[`set${r[0].toUpperCase()}${r.slice(1)}`];i==null||i.call(o,t[r])}return s}_updateStyle(t,n){if(t.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==n.mapStyle){const{mapStyle:o=dt,styleDiffing:s=!0}=t,r={diff:s};return"localIdeographFontFamily"in t&&(r.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(lt(o),r),!0}return!1}_updateStyleComponents(t,n){const o=this._map;let s=!1;return o.isStyleLoaded()&&("light"in t&&o.setLight&&!b(t.light,n.light)&&(s=!0,o.setLight(t.light)),"fog"in t&&o.setFog&&!b(t.fog,n.fog)&&(s=!0,o.setFog(t.fog)),"terrain"in t&&o.setTerrain&&!b(t.terrain,n.terrain)&&(!t.terrain||o.getSource(t.terrain.source))&&(s=!0,o.setTerrain(t.terrain))),s}_updateHandlers(t,n){var o,s;const r=this._map;let i=!1;for(const c of Nt){const a=(o=t[c])!==null&&o!==void 0?o:!0,l=(s=n[c])!==null&&s!==void 0?s:!0;b(a,l)||(i=!0,a?r[c].enable(a):r[c].disable())}return i}_queryRenderedFeatures(t){const n=this._map,o=n.transform,{interactiveLayerIds:s=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(t,{layers:s.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=o}}_updateHover(t){var n;const{props:o}=this;if(o.interactiveLayerIds&&(o.onMouseMove||o.onMouseEnter||o.onMouseLeave)){const r=t.type,i=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,c=this._queryRenderedFeatures(t.point),a=c.length>0;!a&&i&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=c,a&&!i&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=r}else this._hoveredFeatures=null}_fireEvent(t,n,o){const s=this._map,r=s.transform,i=typeof n=="string"?n:n.type;return i==="move"&&this._updateViewState(this.props,!1),i in W&&(typeof n=="object"&&(n.viewState=at(r)),this._map.isMoving())?(s.transform=this._renderTransform,t.call(s,n,o),s.transform=r,s):(t.call(s,n,o),s)}_onBeforeRepaint(){const t=this._map;this._internalUpdate=!0;for(const o in this._deferredEvents)this._deferredEvents[o]&&t.fire(o);this._internalUpdate=!1;const n=this._map.transform;t.transform=this._renderTransform,this._onAfterRepaint=()=>{it(this._renderTransform,n),t.transform=n}}}N.savedMaps=[];function Ot(){let e=null;if(typeof location<"u"){const t=/access_token=([^&\/]*)/.exec(location.search);e=t&&t[1]}try{e=e||ut.MapboxAccessToken}catch{}try{e=e||ut.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return e}const Ft=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function zt(e){if(!e)return null;const t=e.map,n={getMap:()=>t,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:o=>{const s=t.transform;t.transform=e.transform;const r=t.project(o);return t.transform=s,r},unproject:o=>{const s=t.transform;t.transform=e.transform;const r=t.unproject(o);return t.transform=s,r},queryTerrainElevation:(o,s)=>{const r=t.transform;t.transform=e.transform;const i=t.queryTerrainElevation(o,s);return t.transform=r,i},queryRenderedFeatures:(o,s)=>{const r=t.transform;t.transform=e.transform;const i=t.queryRenderedFeatures(o,s);return t.transform=r,i}};for(const o of It(t))!(o in n)&&!Ft.includes(o)&&(n[o]=t[o].bind(t));return n}function It(e){const t=new Set;let n=e;for(;n;){for(const o of Object.getOwnPropertyNames(n))o[0]!=="_"&&typeof e[o]=="function"&&o!=="fire"&&o!=="setEventedParent"&&t.add(o);n=Object.getPrototypeOf(n)}return Array.from(t)}const Ut=typeof document<"u"?f.useLayoutEffect:f.useEffect,Zt=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Dt(e,t){for(const o of Zt)o in t&&(e[o]=t[o]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;n&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"&&e.setRTLTextPlugin(n,o=>{o&&console.error(o)},!0)}const O=f.createContext(null);function Bt(e,t,n){const o=f.useContext(At),[s,r]=f.useState(null),i=f.useRef(),{current:c}=f.useRef({mapLib:null,map:null});f.useEffect(()=>{const u=e.mapLib;let d=!0,h;return Promise.resolve(u||n).then(m=>{if(!d)return;if(!m)throw new Error("Invalid mapLib");const p="Map"in m?m:m.default;if(!p.Map)throw new Error("Invalid mapLib");if(Dt(p,e),!p.supported||p.supported(e))e.reuseMaps&&(h=N.reuse(e,i.current)),h||(h=new N(p.Map,e,i.current)),c.map=zt(h),c.mapLib=p,r(h),o==null||o.onMapMount(c.map,e.id);else throw new Error("Map is not supported by this browser")}).catch(m=>{const{onError:p}=e;p?p({type:"error",target:null,originalEvent:null,error:m}):console.error(m)}),()=>{d=!1,h&&(o==null||o.onMapUnmount(e.id),e.reuseMaps?h.recycle():h.destroy())}},[]),Ut(()=>{s&&s.setProps(e)}),f.useImperativeHandle(t,()=>c.map,[s]);const a=f.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),l={height:"100%"};return f.createElement("div",{id:e.id,ref:i,style:a},s&&f.createElement(O.Provider,{value:c},f.createElement("div",{"mapboxgl-children":"",style:l},e.children)))}const $t=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function j(e,t){if(!e||!t)return;const n=e.style;for(const o in t){const s=t[o];Number.isFinite(s)&&!$t.test(o)?n[o]=`${s}px`:n[o]=s}}function Ht(e,t){const{map:n,mapLib:o}=f.useContext(O),s=f.useRef({props:e});s.current.props=e;const r=f.useMemo(()=>{let x=!1;f.Children.forEach(e.children,w=>{w&&(x=!0)});const v={...e,element:x?document.createElement("div"):null},y=new o.Marker(v);return y.setLngLat([e.longitude,e.latitude]),y.getElement().addEventListener("click",w=>{var E,_;(_=(E=s.current.props).onClick)===null||_===void 0||_.call(E,{type:"click",target:y,originalEvent:w})}),y.on("dragstart",w=>{var E,_;const C=w;C.lngLat=r.getLngLat(),(_=(E=s.current.props).onDragStart)===null||_===void 0||_.call(E,C)}),y.on("drag",w=>{var E,_;const C=w;C.lngLat=r.getLngLat(),(_=(E=s.current.props).onDrag)===null||_===void 0||_.call(E,C)}),y.on("dragend",w=>{var E,_;const C=w;C.lngLat=r.getLngLat(),(_=(E=s.current.props).onDragEnd)===null||_===void 0||_.call(E,C)}),y},[]);f.useEffect(()=>(r.addTo(n.getMap()),()=>{r.remove()}),[]);const{longitude:i,latitude:c,offset:a,style:l,draggable:u=!1,popup:d=null,rotation:h=0,rotationAlignment:m="auto",pitchAlignment:p="auto"}=e;return f.useEffect(()=>{j(r.getElement(),l)},[l]),f.useImperativeHandle(t,()=>r,[]),(r.getLngLat().lng!==i||r.getLngLat().lat!==c)&&r.setLngLat([i,c]),a&&!Rt(r.getOffset(),a)&&r.setOffset(a),r.isDraggable()!==u&&r.setDraggable(u),r.getRotation()!==h&&r.setRotation(h),r.getRotationAlignment()!==m&&r.setRotationAlignment(m),r.getPitchAlignment()!==p&&r.setPitchAlignment(p),r.getPopup()!==d&&r.setPopup(d),wt.createPortal(e.children,r.getElement())}const Vt=f.memo(f.forwardRef(Ht));function mt(e){return new Set(e?e.trim().split(/\s+/):[])}function Wt(e,t){const{map:n,mapLib:o}=f.useContext(O),s=f.useMemo(()=>document.createElement("div"),[]),r=f.useRef({props:e});r.current.props=e;const i=f.useMemo(()=>{const c={...e},a=new o.Popup(c);return a.setLngLat([e.longitude,e.latitude]),a.once("open",l=>{var u,d;(d=(u=r.current.props).onOpen)===null||d===void 0||d.call(u,l)}),a},[]);if(f.useEffect(()=>{const c=a=>{var l,u;(u=(l=r.current.props).onClose)===null||u===void 0||u.call(l,a)};return i.on("close",c),i.setDOMContent(s).addTo(n.getMap()),()=>{i.off("close",c),i.isOpen()&&i.remove()}},[]),f.useEffect(()=>{j(i.getElement(),e.style)},[e.style]),f.useImperativeHandle(t,()=>i,[]),i.isOpen()&&((i.getLngLat().lng!==e.longitude||i.getLngLat().lat!==e.latitude)&&i.setLngLat([e.longitude,e.latitude]),e.offset&&!b(i.options.offset,e.offset)&&i.setOffset(e.offset),(i.options.anchor!==e.anchor||i.options.maxWidth!==e.maxWidth)&&(i.options.anchor=e.anchor,i.setMaxWidth(e.maxWidth)),i.options.className!==e.className)){const c=mt(i.options.className),a=mt(e.className);for(const l of c)a.has(l)||i.removeClassName(l);for(const l of a)c.has(l)||i.addClassName(l);i.options.className=e.className}return wt.createPortal(e.children,s)}const qt=f.memo(f.forwardRef(Wt));function I(e,t,n,o){const s=f.useContext(O),r=f.useMemo(()=>e(s),[]);return f.useEffect(()=>{const i=t,c=null,a=typeof t=="function"?t:null,{map:l}=s;return l.hasControl(r)||(l.addControl(r,i==null?void 0:i.position),c&&c(s)),()=>{a&&a(s),l.hasControl(r)&&l.removeControl(r)}},[]),r}function Gt(e){const t=I(({mapLib:n})=>new n.AttributionControl(e),{position:e.position});return f.useEffect(()=>{j(t._container,e.style)},[e.style]),null}f.memo(Gt);function Kt(e){const t=I(({mapLib:n})=>new n.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return f.useEffect(()=>{j(t._controlContainer,e.style)},[e.style]),null}f.memo(Kt);function Qt(e,t){const n=f.useRef({props:e}),o=I(({mapLib:s})=>{const r=new s.GeolocateControl(e),i=r._setupUI;return r._setupUI=c=>{r._container.hasChildNodes()||i(c)},r.on("geolocate",c=>{var a,l;(l=(a=n.current.props).onGeolocate)===null||l===void 0||l.call(a,c)}),r.on("error",c=>{var a,l;(l=(a=n.current.props).onError)===null||l===void 0||l.call(a,c)}),r.on("outofmaxbounds",c=>{var a,l;(l=(a=n.current.props).onOutOfMaxBounds)===null||l===void 0||l.call(a,c)}),r.on("trackuserlocationstart",c=>{var a,l;(l=(a=n.current.props).onTrackUserLocationStart)===null||l===void 0||l.call(a,c)}),r.on("trackuserlocationend",c=>{var a,l;(l=(a=n.current.props).onTrackUserLocationEnd)===null||l===void 0||l.call(a,c)}),r},{position:e.position});return n.current.props=e,f.useImperativeHandle(t,()=>o,[]),f.useEffect(()=>{j(o._container,e.style)},[e.style]),null}f.memo(f.forwardRef(Qt));function Yt(e){const t=I(({mapLib:n})=>new n.NavigationControl(e),{position:e.position});return f.useEffect(()=>{j(t._container,e.style)},[e.style]),null}f.memo(Yt);function Jt(e){const t=I(({mapLib:r})=>new r.ScaleControl(e),{position:e.position}),n=f.useRef(e),o=n.current;n.current=e;const{style:s}=e;return e.maxWidth!==void 0&&e.maxWidth!==o.maxWidth&&(t.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==o.unit&&t.setUnit(e.unit),f.useEffect(()=>{j(t._container,s)},[s]),null}f.memo(Jt);function $(e,t){if(!e)throw new Error(t)}function Xt(e,t,n,o){if($(n.id===o.id,"layer id changed"),$(n.type===o.type,"layer type changed"),n.type==="custom"||o.type==="custom")return;const{layout:s={},paint:r={},filter:i,minzoom:c,maxzoom:a,beforeId:l}=n;if(l!==o.beforeId&&e.moveLayer(t,l),s!==o.layout){const u=o.layout||{};for(const d in s)b(s[d],u[d])||e.setLayoutProperty(t,d,s[d]);for(const d in u)s.hasOwnProperty(d)||e.setLayoutProperty(t,d,void 0)}if(r!==o.paint){const u=o.paint||{};for(const d in r)b(r[d],u[d])||e.setPaintProperty(t,d,r[d]);for(const d in u)r.hasOwnProperty(d)||e.setPaintProperty(t,d,void 0)}b(i,o.filter)||e.setFilter(t,i),(c!==o.minzoom||a!==o.maxzoom)&&e.setLayerZoomRange(t,c,a)}function te(e,t,n){if(e.style&&e.style._loaded&&(!("source"in n)||e.getSource(n.source))){const o={...n,id:t};delete o.beforeId,e.addLayer(o,n.beforeId)}}let ee=0;function ne(e){const t=f.useContext(O).map.getMap(),n=f.useRef(e),[,o]=f.useState(0),s=f.useMemo(()=>e.id||`jsx-layer-${ee++}`,[]);if(f.useEffect(()=>{if(t){const i=()=>o(c=>c+1);return t.on("styledata",i),i(),()=>{t.off("styledata",i),t.style&&t.style._loaded&&t.getLayer(s)&&t.removeLayer(s)}}},[t]),t&&t.style&&t.getLayer(s))try{Xt(t,s,e,n.current)}catch(i){console.warn(i)}else te(t,s,e);return n.current=e,null}let oe=0;function se(e,t,n){if(e.style&&e.style._loaded){const o={...n};return delete o.id,delete o.children,e.addSource(t,o),e.getSource(t)}return null}function re(e,t,n){$(t.id===n.id,"source id changed"),$(t.type===n.type,"source type changed");let o="",s=0;for(const i in t)i!=="children"&&i!=="id"&&!b(n[i],t[i])&&(o=i,s++);if(!s)return;const r=t.type;r==="geojson"?e.setData(t.data):r==="image"?e.updateImage({url:t.url,coordinates:t.coordinates}):"setCoordinates"in e&&s===1&&o==="coordinates"?e.setCoordinates(t.coordinates):"setUrl"in e&&o==="url"?e.setUrl(t.url):"setTiles"in e&&o==="tiles"?e.setTiles(t.tiles):console.warn(`Unable to update <Source> prop: ${o}`)}function ie(e){const t=f.useContext(O).map.getMap(),n=f.useRef(e),[,o]=f.useState(0),s=f.useMemo(()=>e.id||`jsx-source-${oe++}`,[]);f.useEffect(()=>{if(t){const i=()=>setTimeout(()=>o(c=>c+1),0);return t.on("styledata",i),i(),()=>{var c;if(t.off("styledata",i),t.style&&t.style._loaded&&t.getSource(s)){const a=(c=t.getStyle())===null||c===void 0?void 0:c.layers;if(a)for(const l of a)l.source===s&&t.removeLayer(l.id);t.removeSource(s)}}}},[t]);let r=t&&t.style&&t.getSource(s);return r?re(r,e,n.current):r=se(t,s,e),n.current=e,r&&f.Children.map(e.children,i=>i&&f.cloneElement(i,{source:s}))||null}const ae=bt(()=>import("./maplibre-gl-FinJO4c9.js").then(e=>e.m),__vite__mapDeps([0,1,2])),ce=f.forwardRef(function(t,n){return Bt(t,n,ae)}),q=Vt,le=qt,pt=ne,ue=ie,gt=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],G=1,F=8;class J{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const s=o>>4;if(s!==G)throw new Error(`Got v${s} data when expected v${G}.`);const r=gt[o&15];if(!r)throw new Error("Unrecognized array type.");const[i]=new Uint16Array(t,2,1),[c]=new Uint32Array(t,4,1);return new J(c,i,r,t)}constructor(t,n=64,o=Float64Array,s){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const r=gt.indexOf(this.ArrayType),i=t*2*this.ArrayType.BYTES_PER_ELEMENT,c=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-c%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,F,t),this.coords=new this.ArrayType(this.data,F+c+a,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(F+i+c+a),this.ids=new this.IndexArrayType(this.data,F,t),this.coords=new this.ArrayType(this.data,F+c+a,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(G<<4)+r]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Y(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:i,nodeSize:c}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const u=a.pop()||0,d=a.pop()||0,h=a.pop()||0;if(d-h<=c){for(let v=h;v<=d;v++){const y=i[2*v],w=i[2*v+1];y>=t&&y<=o&&w>=n&&w<=s&&l.push(r[v])}continue}const m=h+d>>1,p=i[2*m],x=i[2*m+1];p>=t&&p<=o&&x>=n&&x<=s&&l.push(r[m]),(u===0?t<=p:n<=x)&&(a.push(h),a.push(m-1),a.push(1-u)),(u===0?o>=p:s>=x)&&(a.push(m+1),a.push(d),a.push(1-u))}return l}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:r,nodeSize:i}=this,c=[0,s.length-1,0],a=[],l=o*o;for(;c.length;){const u=c.pop()||0,d=c.pop()||0,h=c.pop()||0;if(d-h<=i){for(let v=h;v<=d;v++)yt(r[2*v],r[2*v+1],t,n)<=l&&a.push(s[v]);continue}const m=h+d>>1,p=r[2*m],x=r[2*m+1];yt(p,x,t,n)<=l&&a.push(s[m]),(u===0?t-o<=p:n-o<=x)&&(c.push(h),c.push(m-1),c.push(1-u)),(u===0?t+o>=p:n+o>=x)&&(c.push(m+1),c.push(d),c.push(1-u))}return a}}function Y(e,t,n,o,s,r){if(s-o<=n)return;const i=o+s>>1;xt(e,t,i,o,s,r),Y(e,t,n,o,i-1,1-r),Y(e,t,n,i+1,s,1-r)}function xt(e,t,n,o,s,r){for(;s>o;){if(s-o>600){const l=s-o+1,u=n-o+1,d=Math.log(l),h=.5*Math.exp(2*d/3),m=.5*Math.sqrt(d*h*(l-h)/l)*(u-l/2<0?-1:1),p=Math.max(o,Math.floor(n-u*h/l+m)),x=Math.min(s,Math.floor(n+(l-u)*h/l+m));xt(e,t,n,p,x,r)}const i=t[2*n+r];let c=o,a=s;for(z(e,t,o,n),t[2*s+r]>i&&z(e,t,o,s);c<a;){for(z(e,t,c,a),c++,a--;t[2*c+r]<i;)c++;for(;t[2*a+r]>i;)a--}t[2*o+r]===i?z(e,t,o,a):(a++,z(e,t,a,s)),a<=n&&(o=a+1),n<=a&&(s=a-1)}}function z(e,t,n,o){K(e,n,o),K(t,2*n,2*o),K(t,2*n+1,2*o+1)}function K(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function yt(e,t,n,o){const s=e-n,r=t-o;return s*s+r*r}const de={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},vt=Math.fround||(e=>t=>(e[0]=+t,e[0]))(new Float32Array(1)),P=2,R=3,Q=4,A=5,Et=6;class fe{constructor(t){this.options=Object.assign(Object.create(de),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:n,minZoom:o,maxZoom:s}=this.options;n&&console.time("total time");const r=`prepare ${t.length} points`;n&&console.time(r),this.points=t;const i=[];for(let a=0;a<t.length;a++){const l=t[a];if(!l.geometry)continue;const[u,d]=l.geometry.coordinates,h=vt(D(u)),m=vt(B(d));i.push(h,m,1/0,a,-1,1),this.options.reduce&&i.push(0)}let c=this.trees[s+1]=this._createTree(i);n&&console.timeEnd(r);for(let a=s;a>=o;a--){const l=+Date.now();c=this.trees[a]=this._createTree(this._cluster(c,a)),n&&console.log("z%d: %d clusters in %dms",a,c.numItems,+Date.now()-l)}return n&&console.timeEnd("total time"),this}getClusters(t,n){let o=((t[0]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,t[1]));let r=t[2]===180?180:((t[2]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)o=-180,r=180;else if(o>r){const d=this.getClusters([o,s,180,i],n),h=this.getClusters([-180,s,r,i],n);return d.concat(h)}const c=this.trees[this._limitZoom(n)],a=c.range(D(o),B(i),D(r),B(s)),l=c.data,u=[];for(const d of a){const h=this.stride*d;u.push(l[h+A]>1?_t(l,h,this.clusterProps):this.points[l[h+R]])}return u}getChildren(t){const n=this._getOriginId(t),o=this._getOriginZoom(t),s="No cluster with the specified id.",r=this.trees[o];if(!r)throw new Error(s);const i=r.data;if(n*this.stride>=i.length)throw new Error(s);const c=this.options.radius/(this.options.extent*Math.pow(2,o-1)),a=i[n*this.stride],l=i[n*this.stride+1],u=r.within(a,l,c),d=[];for(const h of u){const m=h*this.stride;i[m+Q]===t&&d.push(i[m+A]>1?_t(i,m,this.clusterProps):this.points[i[m+R]])}if(d.length===0)throw new Error(s);return d}getLeaves(t,n,o){n=n||10,o=o||0;const s=[];return this._appendLeaves(s,t,n,o,0),s}getTile(t,n,o){const s=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:i,radius:c}=this.options,a=c/i,l=(o-a)/r,u=(o+1+a)/r,d={features:[]};return this._addTileFeatures(s.range((n-a)/r,l,(n+1+a)/r,u),s.data,n,o,r,d),n===0&&this._addTileFeatures(s.range(1-a/r,l,1,u),s.data,r,o,r,d),n===r-1&&this._addTileFeatures(s.range(0,l,a/r,u),s.data,-1,o,r,d),d.features.length?d:null}getClusterExpansionZoom(t){let n=this._getOriginZoom(t)-1;for(;n<=this.options.maxZoom;){const o=this.getChildren(t);if(n++,o.length!==1)break;t=o[0].properties.cluster_id}return n}_appendLeaves(t,n,o,s,r){const i=this.getChildren(n);for(const c of i){const a=c.properties;if(a&&a.cluster?r+a.point_count<=s?r+=a.point_count:r=this._appendLeaves(t,a.cluster_id,o,s,r):r<s?r++:t.push(c),t.length===o)break}return r}_createTree(t){const n=new J(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let o=0;o<t.length;o+=this.stride)n.add(t[o],t[o+1]);return n.finish(),n.data=t,n}_addTileFeatures(t,n,o,s,r,i){for(const c of t){const a=c*this.stride,l=n[a+A]>1;let u,d,h;if(l)u=Mt(n,a,this.clusterProps),d=n[a],h=n[a+1];else{const x=this.points[n[a+R]];u=x.properties;const[v,y]=x.geometry.coordinates;d=D(v),h=B(y)}const m={type:1,geometry:[[Math.round(this.options.extent*(d*r-o)),Math.round(this.options.extent*(h*r-s))]],tags:u};let p;l||this.options.generateId?p=n[a+R]:p=this.points[n[a+R]].id,p!==void 0&&(m.id=p),i.features.push(m)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,n){const{radius:o,extent:s,reduce:r,minPoints:i}=this.options,c=o/(s*Math.pow(2,n)),a=t.data,l=[],u=this.stride;for(let d=0;d<a.length;d+=u){if(a[d+P]<=n)continue;a[d+P]=n;const h=a[d],m=a[d+1],p=t.within(a[d],a[d+1],c),x=a[d+A];let v=x;for(const y of p){const w=y*u;a[w+P]>n&&(v+=a[w+A])}if(v>x&&v>=i){let y=h*x,w=m*x,E,_=-1;const C=((d/u|0)<<5)+(n+1)+this.points.length;for(const H of p){const S=H*u;if(a[S+P]<=n)continue;a[S+P]=n;const U=a[S+A];y+=a[S]*U,w+=a[S+1]*U,a[S+Q]=C,r&&(E||(E=this._map(a,d,!0),_=this.clusterProps.length,this.clusterProps.push(E)),r(E,this._map(a,S)))}a[d+Q]=C,l.push(y/v,w/v,1/0,C,-1,v),r&&l.push(_)}else{for(let y=0;y<u;y++)l.push(a[d+y]);if(v>1)for(const y of p){const w=y*u;if(!(a[w+P]<=n)){a[w+P]=n;for(let E=0;E<u;E++)l.push(a[w+E])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,n,o){if(t[n+A]>1){const i=this.clusterProps[t[n+Et]];return o?Object.assign({},i):i}const s=this.points[t[n+R]].properties,r=this.options.map(s);return o&&r===s?Object.assign({},r):r}}function _t(e,t,n){return{type:"Feature",id:e[t+R],properties:Mt(e,t,n),geometry:{type:"Point",coordinates:[he(e[t]),me(e[t+1])]}}}function Mt(e,t,n){const o=e[t+A],s=o>=1e4?`${Math.round(o/1e3)}k`:o>=1e3?`${Math.round(o/100)/10}k`:o,r=e[t+Et],i=r===-1?{}:Object.assign({},n[r]);return Object.assign(i,{cluster:!0,cluster_id:e[t+R],point_count:o,point_count_abbreviated:s})}function D(e){return e/360+.5}function B(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function he(e){return(e-.5)*360}function me(e){const t=(180-e*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function pe(e){return e.properties.cluster===!0}function ge(e,t,n){const o=f.useMemo(()=>{const r=new fe({radius:60,maxZoom:16}),i=e.map(c=>({type:"Feature",properties:{cluster:!1,store:c},geometry:{type:"Point",coordinates:[c.lon,c.lat]}}));return r.load(i),r},[e]);return{clusters:f.useMemo(()=>n?o.getClusters(n,Math.floor(t)):[],[o,n,t]),index:o}}const ye=(e,t)=>{const o={latitude:e[1],longitude:e[0]},s=t,r=[],i=s/(111.32*Math.cos(o.latitude*Math.PI/180)),c=s/110.574;for(let a=0;a<64;a++){const l=a/64*(2*Math.PI),u=i*Math.cos(l),d=c*Math.sin(l);r.push([o.longitude+u,o.latitude+d])}return r.push(r[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}}},Me=({userLocation:e,stores:t,selectedStore:n=null,radiusKm:o,onLocationChange:s,isDraggable:r=!1})=>{const[i,c]=f.useState(null),[a,l]=f.useState(e),[u,d]=f.useState(null),[h,m]=f.useState({longitude:e.lon,latitude:e.lat,zoom:12}),[p,x]=f.useState(null);f.useEffect(()=>{m({longitude:e.lon,latitude:e.lat,zoom:12}),l(e)},[e]);const v=f.useCallback(M=>{const{lngLat:L}=M,k={lat:L.lat,lon:L.lng};l(k),s&&s(L.lat,L.lng)},[s]),y=f.useCallback(()=>{if(!u)return;const M=u.getBounds();M&&x([M.getWest(),M.getSouth(),M.getEast(),M.getNorth()])},[u]),w=f.useCallback(M=>{m(M.viewState),y()},[y]),E=f.useCallback(()=>{y()},[y]),_=r?a:e,C=f.useMemo(()=>ye([_.lon,_.lat],o),[_.lon,_.lat,o]),{clusters:H,index:S}=ge(t,h.zoom,p),U=f.useCallback((M,L,k)=>{const T=S.getClusterExpansionZoom(M);u==null||u.flyTo({center:[L,k],zoom:T,duration:500})},[S,u]);return g.jsx("div",{className:"w-full h-[500px] rounded-lg overflow-hidden shadow-lg border border-border",children:g.jsxs(ce,{ref:d,...h,onMove:w,onLoad:E,mapStyle:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",style:{width:"100%",height:"100%"},children:[g.jsxs(ue,{id:"radius",type:"geojson",data:C,children:[g.jsx(pt,{id:"radius-fill",type:"fill",paint:{"fill-color":"#3b82f6","fill-opacity":.1}}),g.jsx(pt,{id:"radius-outline",type:"line",paint:{"line-color":"#3b82f6","line-width":2,"line-opacity":.6}})]}),g.jsx(q,{longitude:_.lon,latitude:_.lat,anchor:"center",draggable:r,onDragEnd:v,children:g.jsxs("div",{className:"relative",children:[!r&&g.jsx("div",{className:"absolute -inset-2 bg-location rounded-full animate-ping opacity-75"}),g.jsx("div",{className:rt("relative bg-location p-2 rounded-full shadow-lg border-2 border-white",r&&"cursor-move"),children:g.jsx(Tt,{className:"h-5 w-5 text-white"})})]})}),H.map(M=>{const[L,k]=M.geometry.coordinates;if(pe(M)){const{cluster_id:Z,point_count:et}=M.properties,V=Math.min(24+et/t.length*40,56);return g.jsx(q,{longitude:L,latitude:k,anchor:"center",onClick:Ct=>{Ct.originalEvent.stopPropagation(),U(Z,L,k)},children:g.jsx("div",{className:"rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold cursor-pointer shadow-lg border-2 border-white transition-transform hover:scale-110",style:{width:`${V}px`,height:`${V}px`,fontSize:`${Math.max(11,V*.35)}px`},children:et})},`cluster-${Z}`)}const T=M.properties.store,X=nt(T.chain),tt=(n==null?void 0:n.id)===T.id;return g.jsx(q,{longitude:T.lon,latitude:T.lat,anchor:"bottom",onClick:Z=>{Z.originalEvent.stopPropagation(),c(T)},children:g.jsx("div",{className:`cursor-pointer transition-transform hover:scale-110 ${tt?"scale-125":""}`,children:g.jsxs("div",{className:"relative",style:{filter:tt?"drop-shadow(0 0 8px rgba(34, 197, 94, 0.8))":""},children:[g.jsxs("svg",{width:"46",height:"58",viewBox:"0 0 40 50",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[g.jsx("path",{d:"M20 0C8.95 0 0 8.95 0 20C0 35 20 50 20 50C20 50 40 35 40 20C40 8.95 31.05 0 20 0Z",fill:X}),g.jsx("circle",{cx:"20",cy:"18",r:"10",fill:"white"})]}),g.jsx("div",{className:"absolute top-[8px] left-1/2 transform -translate-x-1/2",children:g.jsx(ot,{chain:T.chain,className:"h-5 w-5",color:X})})]})})},T.id)}),i&&g.jsx(le,{longitude:i.lon,latitude:i.lat,anchor:"top",onClose:()=>c(null),closeButton:!0,closeOnClick:!1,maxWidth:"280px",children:g.jsxs("div",{className:"p-3 pr-8",children:[g.jsxs("div",{className:"flex items-start gap-2.5 mb-2",children:[g.jsx("div",{className:"p-1.5 rounded shrink-0",style:{backgroundColor:nt(i.chain)},children:g.jsx(ot,{chain:i.chain,className:"h-4 w-4 text-white"})}),g.jsxs("div",{className:"min-w-0",children:[g.jsx("h3",{className:"font-semibold text-primary-gray text-sm leading-tight",children:i.name}),g.jsx("p",{className:"text-xs text-secondary-gray mt-0.5 line-clamp-2",children:i.address})]})]}),st(i.distance_km)&&g.jsxs("div",{className:rt("flex items-center gap-1 text-xs font-medium",St(i.distance_km)),children:[g.jsx(Lt,{className:"h-3.5 w-3.5"}),g.jsxs("span",{children:[st(i.distance_km)," away"]})]})]})})]})})};export{Me as StoreMap};
