import{r,u as C,j as e}from"./react-vendor-DRgtYQPK.js";import{b as I,a as y,S as E,I as z,B as N,P as A,c as D,L as q,d as T}from"./index-CCG829II.js";import{u as M}from"./index-Cej45ULi.js";import{S as B,A as F,M as O}from"./ui-vendor-CBOXGLFg.js";import"./map-vendor-CjvMc6d-.js";import"./radix-vendor-D8ftTHn1.js";const U="http://localhost:8000",$=()=>{const[l,i]=r.useState(null),[d,n]=r.useState(!1),[m,c]=r.useState(null),t=r.useRef(null),s=r.useRef(0),u=r.useCallback(async a=>{var g;s.current+=1;const x=s.current;(g=t.current)==null||g.abort();const f=new AbortController;t.current=f,n(!0),c(null);try{const p=I(a);if(a.limit!==void 0&&p.append("page_size",a.limit.toString()),a.offset!==void 0&&a.limit!==void 0){const h=Math.floor(a.offset/a.limit)+1;p.append("page",h.toString())}else a.limit!==void 0&&p.append("page","1");const{data:b}=await y.get(`${U}/products`,{params:p,signal:f.signal});if(x!==s.current)return;i(b)}catch(p){if(y.isCancel(p)||x!==s.current)return;c("Failed to load products"),i(null)}finally{x===s.current&&n(!1)}},[]);return r.useEffect(()=>()=>{var a;(a=t.current)==null||a.abort()},[]),{products:l,loading:d,error:m,fetchProducts:u}},K="http://localhost:8000",Q=()=>{const[l,i]=r.useState([]),[d,n]=r.useState(!1),[m,c]=r.useState(null),t=r.useCallback(async(s,u=20)=>{n(!0),c(null);try{const a=new URLSearchParams({lat:s.lat.toString(),lon:s.lon.toString(),radius_km:u.toString()}),{data:x}=await y.get(`${K}/stores?${a.toString()}`);i(x.items)}catch(a){c("Failed to load nearby stores"),console.error("Error fetching stores:",a)}finally{n(!1)}},[]);return{stores:l,loading:d,error:m,fetchNearbyStores:t}},V=({onIntersect:l,enabled:i=!0,rootMargin:d="200px",threshold:n=.1})=>{const m=r.useRef(null),c=r.useRef(!1);return r.useEffect(()=>{if(!i)return;const t=m.current;if(!t)return;const s=new IntersectionObserver(u=>{const[a]=u;a.isIntersecting&&!c.current?(c.current=!0,l()):a.isIntersecting||(c.current=!1)},{rootMargin:d,threshold:n});return s.observe(t),()=>{t&&s.unobserve(t)}},[i,l,d,n]),m},ee=()=>{const[l,i]=r.useState(""),d=C(),{products:n,loading:m,fetchProducts:c}=$(),{location:t,radiusKm:s,setRadiusKm:u,requestAutoLocation:a,loading:x,error:f}=M(),{stores:g,loading:p,fetchNearbyStores:b}=Q(),[h,v]=r.useState(s),[R,_]=r.useState(!1),k=V({enabled:!!t,onIntersect:()=>_(!0)}),S=10;r.useEffect(()=>{t&&!p&&b(t,s)},[t,s,b]),r.useEffect(()=>{c(t?{promo_only:!0,limit:S,sort:E.DISCOUNT,unique_products:!0,lat:t.lat,lon:t.lon,radius_km:s}:{promo_only:!0,limit:S,sort:E.DISCOUNT,unique_products:!0})},[t,s,c]),r.useEffect(()=>{v(s)},[s]),r.useEffect(()=>{const o=window.setTimeout(()=>{h!==s&&u(h)},500);return()=>window.clearTimeout(o)},[h,s,u]);const w=n!=null&&n.items?n.items.filter(o=>{const j=o.price.promo_price_nzd;return j!=null&&j<o.price.price_nzd}).map(o=>({...o,discountPercent:(o.price.price_nzd-(o.price.promo_price_nzd||0))/o.price.price_nzd*100})).sort((o,j)=>j.discountPercent-o.discountPercent).slice(0,10):[],P=()=>{const o=l.trim();d(o?`/explore?q=${encodeURIComponent(o)}`:"/explore")},L=()=>{d("/explore?promo_only=true")};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("section",{className:"bg-primary",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-16 md:py-20 text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-semibold text-white mb-3 tracking-tight",children:"Compare liquor prices across NZ"}),e.jsx("p",{className:"text-base text-white/80 mb-8 max-w-lg mx-auto",children:"Find the best deals from major retailers near you"}),e.jsxs("div",{className:"relative max-w-xl mx-auto",children:[e.jsx(B,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(z,{placeholder:"Search for beer, wine, or spirits",value:l,onChange:o=>i(o.target.value),onKeyDown:o=>o.key==="Enter"&&P(),className:"pl-12 pr-24 h-12 text-base rounded-lg border-0 bg-white text-foreground shadow-sm"}),e.jsx(N,{onClick:P,size:"sm",className:"absolute right-1.5 top-1/2 -translate-y-1/2 h-9",children:"Search"})]})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("section",{className:"py-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:t?"Deals Near You":"Top Deals"}),!t&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enable location for personalized results"})]}),e.jsxs(N,{onClick:L,variant:"ghost",size:"sm",className:"text-primary",children:["View all",e.jsx(F,{className:"ml-1 h-4 w-4"})]})]}),e.jsx(A,{products:w,loading:m}),!m&&w.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No deals available"})})]}),e.jsxs("section",{className:"py-12 border-t",children:[!t&&e.jsxs("div",{className:"max-w-md mx-auto text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-lg bg-secondary mb-4",children:e.jsx(O,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Enable Location"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"See deals from stores in your area"}),e.jsx(N,{onClick:a,disabled:x,children:x?"Getting location...":"Enable Location"}),f&&e.jsx("p",{className:"text-destructive text-sm mt-4",children:f})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-secondary rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Search radius"}),e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[h," km"]})]}),e.jsx(D,{value:[h],onValueChange:o=>v(o[0]),min:1,max:10,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:"1 km"}),e.jsxs("span",{children:[g.length," stores"]}),e.jsx("span",{children:"10 km"})]})]}),e.jsx("div",{ref:k,className:"rounded-lg overflow-hidden border",children:R?e.jsx(q,{userLocation:t,stores:g,selectedStore:null,onStoreClick:()=>{},radiusKm:s}):e.jsx(T,{className:"h-[400px] border-none"})})]})]}),e.jsxs("section",{className:"py-12 border-t",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Transparent Pricing"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto",children:"Compare prices across major retailers in real-time"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 sm:gap-8 max-w-lg mx-auto mb-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-semibold text-primary",children:"10+"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Retailers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-semibold text-primary",children:"Updated Daily"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Prices"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-semibold text-primary",children:"Free"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Always"})]})]}),e.jsxs("div",{className:"bg-secondary rounded-lg p-6 max-w-lg mx-auto text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Drink Responsibly"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["You must be 18+ to purchase alcohol. If you need support, visit"," ",e.jsx("a",{href:"https://www.alcohol.org.nz",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Alcohol.org.nz"})]})]})]})]})]})};export{ee as Landing,ee as default};
