import{j as e,L as Se,g as de,r as n}from"./react-vendor-DRgtYQPK.js";import{u as $,t as ee}from"./index-Cej45ULi.js";import{I as se,B as S,S as L,e as me,f as y,c as W,D as Ce,g as ke,h as U,i as V,j as ae,L as Le,b as Pe,a as te,k as _e,C as Ee,P as Re}from"./index-CCG829II.js";import{S as re,M as K,a as Fe,C as Me,b as ue,X as le,G as Ae,c as Te,d as Be,D as De,e as Ie,f as ne,L as qe,N as G,g as Oe,h as $e,E as Ue,i as Ve}from"./ui-vendor-CBOXGLFg.js";import{R as ze,V as We,T as xe,I as Ge,P as Ke,C as he,a as He,b as pe,c as Qe,d as Ye,L as ge,S as fe,e as je,f as Xe,g as be}from"./radix-vendor-D8ftTHn1.js";import"./map-vendor-CjvMc6d-.js";const Ze=({query:s,setQuery:a,onSearch:t,variant:r="compact"})=>{const{radiusKm:u,isLocationSet:l,openLocationModal:o}=$();return r==="landing"?e.jsx("header",{className:"bg-primary border-b border-primary",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-semibold text-white mb-2 tracking-tight",children:"LIQUORFY"}),e.jsx("p",{className:"text-sm text-white/80 mb-6",children:"Compare liquor prices across NZ"}),e.jsxs("div",{className:"max-w-xl mx-auto relative",children:[e.jsx(re,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(se,{placeholder:"Search for beer, wine, spirits...",value:s,onChange:i=>a(i.target.value),onKeyDown:i=>i.key==="Enter"&&t(),className:"pl-12 h-12 bg-white text-base"})]})]})})}):e.jsx("header",{className:"bg-primary border-b border-primary",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-6",children:[e.jsx(Se,{to:"/",className:"flex-shrink-0",children:e.jsx("span",{className:"text-lg font-semibold text-white",children:"LIQUORFY"})}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"Search products...",value:s,onChange:i=>a(i.target.value),onKeyDown:i=>i.key==="Enter"&&t(),className:"pl-10 h-9 bg-white text-sm"})]})}),e.jsxs(S,{variant:"ghost",size:"sm",onClick:o,className:"flex-shrink-0 text-white hover:bg-white/10 gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:l?`${u} km`:"Location"})]})]})})})},H=()=>{const[s,a]=de(),t=n.useRef(new URLSearchParams(s));n.useEffect(()=>{t.current=new URLSearchParams(s)},[s]);const r=n.useMemo(()=>{const d=s.get("q")||void 0,c=s.get("category")||void 0,p=s.get("chain"),m=p?p.split(","):void 0,g=s.get("promo_only")==="true"?!0:void 0,C=s.get("price_min")?parseFloat(s.get("price_min")):void 0,j=s.get("price_max")?parseFloat(s.get("price_max")):void 0,b=s.get("sort")||(g?L.DISCOUNT:L.BEST_VALUE),v=s.get("store_ids"),P=v?v.split(","):void 0;return{query:d,category:c,chains:m,promo_only:g,price_min:C,price_max:j,sort:b,store_ids:P}},[s]),u=n.useCallback(d=>{const c=new URLSearchParams(t.current);Object.keys(d).length>0&&c.delete("page"),Object.entries(d).forEach(([p,m])=>{m==null||m===""?c.delete(p):p==="chains"&&Array.isArray(m)?m.length===0?c.delete("chain"):c.set("chain",m.join(",")):p==="store_ids"&&Array.isArray(m)?m.length===0?c.delete("store_ids"):c.set("store_ids",m.join(",")):p==="promo_only"?m?c.set("promo_only","true"):c.delete("promo_only"):c.set(p,String(m))}),t.current=new URLSearchParams(c),a(c)},[a]),l=n.useCallback(()=>{t.current=new URLSearchParams,a({})},[a]),o=n.useMemo(()=>{var d;return!!(r.query||r.category||(d=r.chains)!=null&&d.length||r.promo_only||r.price_min||r.price_max||r.sort&&r.sort!==L.BEST_VALUE)},[r]),i=n.useMemo(()=>{var c;let d=0;return r.category&&d++,(c=r.chains)!=null&&c.length&&(d+=r.chains.length),r.promo_only&&d++,(r.price_min||r.price_max)&&d++,r.sort&&r.sort!==L.BEST_VALUE&&d++,d},[r]);return{filters:r,updateFilters:u,clearFilters:l,hasActiveFilters:o,activeFilterCount:i}},Je=({onOpenFilters:s})=>{const{activeFilterCount:a}=H();return e.jsx("div",{className:"bg-white border-b border-subtle lg:hidden",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-5",children:e.jsxs(S,{variant:"outline",onClick:s,className:"flex items-center gap-2 border-subtle py-4 px-4",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Filters",a>0&&e.jsx(me,{className:"bg-primary text-white ml-1",children:a})]})})})},ye=ze,ve=We,Q=n.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(xe,{ref:r,className:y("flex h-10 w-full items-center justify-between rounded-md border border-gray-300 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:[a,e.jsx(Ge,{asChild:!0,children:e.jsx(Me,{className:"h-4 w-4 opacity-50"})})]}));Q.displayName=xe.displayName;const Y=n.forwardRef(({className:s,children:a,position:t="popper",...r},u)=>e.jsx(Ke,{children:e.jsx(he,{ref:u,className:y("relative z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-300 bg-white text-gray-900 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...r,children:e.jsx(He,{className:y("max-h-[var(--radix-select-content-available-height)] overflow-y-auto p-1",t==="popper"&&"w-full min-w-[var(--radix-select-trigger-width)]"),children:a})})}));Y.displayName=he.displayName;const es=n.forwardRef(({className:s,...a},t)=>e.jsx(ge,{ref:t,className:y("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a}));es.displayName=ge.displayName;const O=n.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(pe,{ref:r,className:y("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Qe,{children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsx(Ye,{children:a})]}));O.displayName=pe.displayName;const ss=n.forwardRef(({className:s,...a},t)=>e.jsx(fe,{ref:t,className:y("-mx-1 my-1 h-px bg-gray-200",s),...a}));ss.displayName=fe.displayName;const as=[{value:L.DISCOUNT,label:"Largest Discount"},{value:L.BEST_VALUE,label:"Best Value (per 100ml)"},{value:L.CHEAPEST,label:"Cheapest"},{value:L.BEST_PER_DRINK,label:"Best per Drink"},{value:L.DISTANCE,label:"Nearest Store"},{value:L.NEWEST,label:"Newest"}],ts=({value:s,onChange:a})=>e.jsxs(ye,{value:s,onValueChange:a,children:[e.jsx(Q,{id:"sort",className:"w-full",children:e.jsx(ve,{})}),e.jsx(Y,{children:as.map(t=>e.jsx(O,{value:t.value,children:t.label},t.value))})]}),rs=[{value:"beer",label:"All Beer",group:"Beer"},{value:"lager",label:"Lager",group:"Beer"},{value:"ale",label:"Ale",group:"Beer"},{value:"ipa",label:"IPA",group:"Beer"},{value:"stout",label:"Stout",group:"Beer"},{value:"craft_beer",label:"Craft Beer",group:"Beer"},{value:"wine",label:"All Wine",group:"Wine"},{value:"red_wine",label:"Red Wine",group:"Wine"},{value:"white_wine",label:"White Wine",group:"Wine"},{value:"rose",label:"RosÃ©",group:"Wine"},{value:"sparkling",label:"Sparkling Wine",group:"Wine"},{value:"champagne",label:"Champagne",group:"Wine"},{value:"spirits",label:"All Spirits",group:"Spirits"},{value:"vodka",label:"Vodka",group:"Spirits"},{value:"gin",label:"Gin",group:"Spirits"},{value:"rum",label:"Rum",group:"Spirits"},{value:"whisky",label:"Whisky",group:"Spirits"},{value:"bourbon",label:"Bourbon",group:"Spirits"},{value:"scotch",label:"Scotch",group:"Spirits"},{value:"tequila",label:"Tequila",group:"Spirits"},{value:"brandy",label:"Brandy",group:"Spirits"},{value:"liqueur",label:"Liqueur",group:"Spirits"},{value:"rtd",label:"RTD (Ready to Drink)",group:"Other"},{value:"cider",label:"Cider",group:"Other"},{value:"mixer",label:"Mixers",group:"Other"},{value:"non_alcoholic",label:"Non-Alcoholic",group:"Other"}],ls=rs.reduce((s,a)=>(s[a.group]||(s[a.group]=[]),s[a.group].push(a),s),{}),ns=({value:s,onChange:a})=>e.jsxs(ye,{value:s||"all",onValueChange:t=>a(t==="all"?void 0:t),children:[e.jsx(Q,{id:"category",className:"w-full",children:e.jsx(ve,{placeholder:"All Categories"})}),e.jsxs(Y,{children:[e.jsx(O,{value:"all",children:"All Categories"}),Object.entries(ls).map(([t,r])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:t}),r.map(u=>e.jsx(O,{value:u.value,children:u.label},u.value))]},t))]})]}),X=n.forwardRef(({className:s,...a},t)=>e.jsx(je,{ref:t,className:y("peer h-4 w-4 shrink-0 rounded-sm border border-gray-300 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 data-[state=checked]:text-white",s),...a,children:e.jsx(Xe,{className:y("flex items-center justify-center text-current"),children:e.jsx(ue,{className:"h-3 w-3"})})}));X.displayName=je.displayName;const Z=n.forwardRef(({className:s,...a},t)=>e.jsx(be,{ref:t,className:y("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",s),...a}));Z.displayName=be.displayName;const ie=[{value:"countdown",label:"Countdown"},{value:"liquorland",label:"Liquorland"},{value:"liquor_centre",label:"Liquor Centre"},{value:"super_liquor",label:"Super Liquor"},{value:"bottle_o",label:"The Bottle-O"},{value:"new_world",label:"New World"},{value:"paknsave",label:"Pak'nSave"},{value:"glengarry",label:"Glengarry"},{value:"thirsty_liquor",label:"Thirsty Liquor"},{value:"black_bull",label:"Black Bull"},{value:"big_barrel",label:"Big Barrel"}],is=({selected:s,onChange:a})=>{const t=l=>{const o=s.includes(l)?s.filter(i=>i!==l):[...s,l];a(o)},r=()=>{a(ie.map(l=>l.value))},u=()=>{a([])};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{onClick:r,className:"text-primary hover:text-accent transition-colors",children:"Select All"}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsx("button",{onClick:u,className:"text-muted-foreground hover:text-foreground transition-colors",children:"Clear"})]})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 pr-2",children:ie.map(l=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{id:l.value,checked:s.includes(l.value),onCheckedChange:()=>t(l.value)}),e.jsx(Z,{htmlFor:l.value,className:"text-sm font-normal cursor-pointer",children:l.label})]},l.value))})]})},os=({checked:s,onChange:a})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{id:"promo-only",checked:s,onCheckedChange:t=>a(t===!0)}),e.jsx(Z,{htmlFor:"promo-only",className:"text-sm font-medium cursor-pointer",children:"Promo items only"})]}),B=0,D=200,cs=1,ds=({min:s,max:a,onChange:t})=>{const[r,u]=n.useState([s??B,a??D]);return n.useEffect(()=>{const l=typeof s=="number"?s:B,o=typeof a=="number"?a:D,i=l<=o?[l,o]:[o,l];u(d=>d[0]===i[0]&&d[1]===i[1]?d:i)},[s,a]),n.useEffect(()=>{const l=setTimeout(()=>{const[o,i]=r,d=o!==B?o:void 0,c=i!==D?i:void 0;(typeof s=="number"?s===d:d===void 0)&&(typeof a=="number"?a===c:c===void 0)||t(d,c)},350);return()=>clearTimeout(l)},[r,s,a,t]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-right text-sm text-tertiary-gray",children:["$",Math.round(r[0])," - $",Math.round(r[1])]}),e.jsx(W,{value:r,min:B,max:D,step:cs,onValueChange:l=>{if(l.length<2)return;const o=Math.min(l[0],l[1]),i=Math.max(l[0],l[1]);u([o,i])}}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-tertiary-gray",children:[e.jsxs("span",{children:["$",B]}),e.jsxs("span",{children:["$",D,"+"]})]})]})},ms=({isOpen:s,onClose:a})=>{const{filters:t,updateFilters:r,clearFilters:u,activeFilterCount:l}=H();return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-30 lg:hidden",onClick:a}),e.jsx("aside",{className:`
          fixed lg:sticky top-0 lg:top-0 left-0 h-[100dvh] lg:max-h-screen w-72 bg-white
          transform transition-all duration-300 ease-out z-40
          ${s?"translate-x-0 shadow-xl lg:shadow-none":"-translate-x-full"}
          border-r border-border/40 lg:self-start
        `,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-border/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-gray tracking-tight",children:"Filters"}),l>0&&e.jsx(me,{className:"bg-primary/10 text-primary border-primary/20 text-xs px-2",children:l})]}),e.jsx(S,{variant:"ghost",size:"icon",onClick:a,className:"lg:hidden -mr-2 hover:bg-gray-100 rounded-lg",children:e.jsx(le,{className:"h-4 w-4"})})]}),l>0&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:u,className:"w-full justify-start text-secondary-gray hover:text-primary-gray hover:bg-gray-50 rounded-lg -ml-2",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Clear all filters"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ae,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Category"})]}),e.jsx(ns,{value:t.category,onChange:o=>r({category:o})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Te,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Sort By"})]}),e.jsx(ts,{value:t.sort||L.BEST_VALUE,onChange:o=>r({sort:o})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Be,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Deals & Promos"})]}),e.jsx(os,{checked:t.promo_only||!1,onChange:o=>r({promo_only:o})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(De,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Price Range"})]}),e.jsx(ds,{min:t.price_min,max:t.price_max,onChange:(o,i)=>r({price_min:o,price_max:i})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Stores"})]}),e.jsx(is,{selected:t.chains||[],onChange:o=>r({chains:o})})]})]})]})})]})};async function oe(s){try{const a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s.lat}&lon=${s.lon}&zoom=14&addressdetails=1`,{headers:{"User-Agent":"Liquorfy/1.0"}});if(!a.ok)return console.error("Reverse geocoding failed:",a.statusText),null;const t=await a.json();if(!t||t.error)return console.error("Reverse geocoding error:",t==null?void 0:t.error),null;const r=t.address||{},u=r.suburb||r.neighbourhood||r.hamlet,l=r.city||r.town||r.village||r.municipality,o=r.state||r.region,i=[u,l,o].filter(Boolean);return{address:i.length>0?i.join(", "):t.display_name,suburb:u,city:l,region:o}}catch(a){return console.error("Error reverse geocoding:",a),null}}function ce(s,a){return s?s.address:`${a.lat.toFixed(4)}, ${a.lon.toFixed(4)}`}const us=()=>{const{location:s,radiusKm:a,loading:t,error:r,isLocationModalOpen:u,closeLocationModal:l,requestAutoLocation:o,setManualLocation:i,setRadiusKm:d,isLocationSet:c}=$(),[p,m]=n.useState("initial"),[g,C]=n.useState(a),[j,k]=n.useState(s),[b,v]=n.useState("");n.useEffect(()=>{u&&(c&&s?(m("auto-success"),k(s),C(a)):(m("initial"),C(a)))},[u,c,s,a]),n.useEffect(()=>{s&&oe(s).then(x=>{v(x?ce(x,s):`${s.lat.toFixed(4)}, ${s.lon.toFixed(4)}`)})},[s]);const P=async()=>{try{await o(),m("auto-success")}catch{m("manual-map")}},f=()=>{m("manual-map"),j||k({lat:-41.2924,lon:174.7787})},N=async(x,R)=>{k({lat:x,lon:R});const A=await oe({lat:x,lon:R});v(A?ce(A,{lat:x,lon:R}):`${x.toFixed(4)}, ${R.toFixed(4)}`)},_=()=>{j&&(i(j.lat,j.lon,g),l(),ee.success("Location set",{description:`Finding products within ${g}km`,duration:3e3}))},M=()=>{d(g),l(),ee.success("Location updated",{description:`Search radius set to ${g}km`,duration:3e3})},E=c;return e.jsx(Ce,{open:u,onOpenChange:E?l:void 0,children:e.jsxs(ke,{className:`sm:max-w-[600px] ${E?"":"[&>button]:hidden"}`,onPointerDownOutside:x=>!E&&x.preventDefault(),onEscapeKeyDown:x=>!E&&x.preventDefault(),children:[p==="initial"&&e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Set Your Location"}),e.jsx(ae,{children:"To show you products from nearby stores, we need your location."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[r&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:r})]}),e.jsx(S,{onClick:P,disabled:t,className:"w-full h-14 text-lg",size:"lg",children:t?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-5 h-5 mr-2 animate-spin"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Use My Location"]})}),e.jsxs(S,{onClick:f,variant:"outline",className:"w-full h-14 text-lg",size:"lg",disabled:t,children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Set Location on Map"]})]})]}),p==="auto-success"&&s&&e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-6 h-6 text-green-600"}),"Location Set"]})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"Using your current location"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:b||"Loading address..."}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[s.lat.toFixed(4),", ",s.lon.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Search Radius: ",g,"km"]}),e.jsx(W,{value:[g],onValueChange:x=>C(x[0]),min:1,max:10,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"1km"}),e.jsx("span",{children:"10km"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:()=>m("manual-map"),className:"flex-1",children:"Adjust Manually"}),e.jsx(S,{onClick:M,className:"flex-1",children:"Continue"})]})]})]}),p==="manual-map"&&e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Set Location on Map"}),e.jsx(ae,{children:"Drag the pin to your approximate location"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[r&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:r})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden h-[400px]",children:e.jsx(Le,{userLocation:j||{lat:-41.2924,lon:174.7787},stores:[],onLocationChange:N,isDraggable:!0,radiusKm:g,fallbackClassName:"h-[400px] border-none"})}),j&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-primary-gray",children:b||"Loading address..."}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[j.lat.toFixed(4),", ",j.lon.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Search Radius: ",g,"km"]}),e.jsx(W,{value:[g],onValueChange:x=>C(x[0]),min:1,max:10,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"1km"}),e.jsx("span",{children:"10km"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:()=>m("initial"),className:"flex-1",children:"Back"}),e.jsx(S,{onClick:_,className:"flex-1",children:"Confirm Location"})]})]})]})]})})},xs=({children:s})=>{const{isLocationSet:a,openLocationModal:t}=$();return n.useEffect(()=>{a||t()},[a,t]),e.jsxs(e.Fragment,{children:[e.jsx(us,{}),s]})},hs="http://localhost:8000",z=24,ps=()=>{const[s,a]=n.useState([]),[t,r]=n.useState(0),[u,l]=n.useState(!1),[o,i]=n.useState(null),[d,c]=n.useState(1),p=n.useRef(null),m=n.useRef(0),g=Math.ceil(t/z),C=n.useCallback(async(b,v=1)=>{var N;m.current+=1;const P=m.current;(N=p.current)==null||N.abort();const f=new AbortController;p.current=f,l(!0),i(null),c(v);try{const _=Pe(b);_.append("page_size",z.toString()),_.append("page",v.toString());const{data:M}=await te.get(`${hs}/products`,{params:_,signal:f.signal});if(P!==m.current)return;a(M.items),r(M.total)}catch(_){if(te.isCancel(_)||P!==m.current)return;i("Failed to load products"),a([]),r(0)}finally{P===m.current&&l(!1)}},[]);n.useEffect(()=>()=>{var b;(b=p.current)==null||b.abort()},[]);const j=n.useCallback(b=>{b>=1&&b<=g&&(c(b),window.scrollTo({top:0,behavior:"smooth"}))},[g]),k=n.useCallback(()=>{a([]),r(0)},[]);return{products:s,total:t,loading:u,error:o,currentPage:d,totalPages:g,pageSize:z,fetchProducts:C,goToPage:j,clearProducts:k}},gs=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:y("mx-auto flex w-full justify-center",s),...a}),fs=({className:s,...a})=>e.jsx("ul",{className:y("flex flex-row items-center gap-1",s),...a}),q=({className:s,...a})=>e.jsx("li",{className:y("",s),...a}),J=({className:s,isActive:a,size:t="icon",...r})=>e.jsx("a",{"aria-current":a?"page":void 0,className:y(_e({variant:a?"default":"outline",size:t}),"cursor-pointer",s),...r}),js=({className:s,...a})=>e.jsxs(J,{"aria-label":"Go to previous page",size:"default",className:y("gap-1 pl-2.5",s),...a,children:[e.jsx($e,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),bs=({className:s,...a})=>e.jsxs(J,{"aria-label":"Go to next page",size:"default",className:y("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(Ve,{className:"h-4 w-4"})]}),ys=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:y("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]}),Ls=()=>{const[a,t]=de(),[r,u]=n.useState(""),[l,o]=n.useState(!0),{location:i,radiusKm:d,isLocationSet:c,openLocationModal:p,requestAutoLocation:m,loading:g,error:C}=$(),{filters:j}=H(),{products:k,total:b,loading:v,error:P,currentPage:f,totalPages:N,fetchProducts:_,goToPage:M,clearProducts:E}=ps(),x=parseInt(a.get("page")||"1",10),R=n.useRef(null);n.useEffect(()=>{u(j.query||"")},[j.query]),n.useEffect(()=>{if(!i||!c)return;const h=JSON.stringify({filters:j,location:i,radiusKm:d,isLocationSet:c}),w=R.current,F=!!(w&&w.page!==x&&w.nonPageKey===h);R.current={page:x,nonPageKey:h};const I={...j,lat:i.lat,lon:i.lon,radius_km:d};if(F){_(I,x);return}E();const T=window.setTimeout(()=>{_(I,x)},220);return()=>window.clearTimeout(T)},[j,i,d,x,c,E]);const A=h=>{const w=new URLSearchParams(a);w.set("page",h.toString()),t(w),M(h)},Ne=()=>{const h=[];if(N<=7)for(let F=1;F<=N;F++)h.push(F);else{h.push(1),f>3&&h.push("ellipsis");const F=Math.max(2,f-1),I=Math.min(N-1,f+1);for(let T=F;T<=I;T++)h.push(T);f<N-2&&h.push("ellipsis"),h.push(N)}return h},we=()=>{const h=r.trim(),w=new URLSearchParams(a);h?w.set("q",h):w.delete("q"),w.delete("page"),t(w)};return e.jsx(xs,{children:e.jsxs("div",{className:"min-h-screen bg-secondary",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-secondary",children:[e.jsx(Ze,{query:r,setQuery:u,onSearch:we,variant:"compact"}),e.jsx(Je,{onOpenFilters:()=>o(!0)})]}),e.jsxs("div",{className:"flex",children:[e.jsx(ms,{isOpen:l,onClose:()=>o(!1)}),e.jsx("main",{className:"flex-1 overflow-y-auto min-h-screen overscroll-none",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 pb-32",children:[!c&&e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs(Ee,{className:"p-8 text-center max-w-md border bg-card",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-lg bg-secondary mb-4",children:e.jsx(G,{className:"h-6 w-6 text-primary"})}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Location Required"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Enable location to see products from stores in your area."}),C&&e.jsx("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:C})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{onClick:m,disabled:g,className:"w-full",children:g?"Getting location...":e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Use My Location"]})}),e.jsxs(S,{onClick:p,variant:"outline",className:"w-full",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Set Manually"]})]})]})}),c&&e.jsxs(e.Fragment,{children:[P&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-destructive",children:P})}),!v&&k.length>0&&e.jsxs("div",{className:"mb-4 flex items-center justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:b===0?"No products found":`${(f-1)*24+1}-${Math.min(f*24,b)} of ${b}`}),e.jsxs("span",{children:["Page ",f," of ",N]})]}),e.jsx(Re,{products:k,loading:v}),!v&&k.length>0&&N>1&&e.jsx("div",{className:"mt-6",children:e.jsx(gs,{children:e.jsxs(fs,{children:[e.jsx(q,{children:e.jsx(js,{onClick:()=>f>1&&A(f-1),className:f===1?"pointer-events-none opacity-50":""})}),Ne().map((h,w)=>h==="ellipsis"?e.jsx(q,{children:e.jsx(ys,{})},`ellipsis-${w}`):e.jsx(q,{children:e.jsx(J,{onClick:()=>A(h),isActive:f===h,children:h})},h)),e.jsx(q,{children:e.jsx(bs,{onClick:()=>f<N&&A(f+1),className:f===N?"pointer-events-none opacity-50":""})})]})})}),!v&&k.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No products found. Try adjusting your filters."})})]})]})})]})]})})};export{Ls as Explore,Ls as default};
