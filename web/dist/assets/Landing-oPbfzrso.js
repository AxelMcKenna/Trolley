import{r as a,u as I,a as R,j as e}from"./index-Coi2vgDx.js";import{S,P as z,a as D,L as T,b as A}from"./index-DrjjgTOJ.js";import{c as q,a as M,S as B,I as O,B as f,b as U,M as F}from"./productParams-DSKcz1WG.js";import{u as K}from"./useProducts-DxCa8dnL.js";const k=q("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),V="http://localhost:8000",$=()=>{const[i,m]=a.useState([]),[l,n]=a.useState(!1),[d,o]=a.useState(null),s=a.useCallback(async(r,x=20)=>{n(!0),o(null);try{const c=new URLSearchParams({lat:r.lat.toString(),lon:r.lon.toString(),radius_km:x.toString()}),{data:p}=await M.get(`${V}/stores?${c.toString()}`);m(p.items)}catch(c){o("Failed to load nearby stores"),console.error("Error fetching stores:",c)}finally{n(!1)}},[]);return{stores:i,loading:l,error:d,fetchNearbyStores:s}},G=({onIntersect:i,enabled:m=!0,rootMargin:l="200px",threshold:n=.1})=>{const d=a.useRef(null),o=a.useRef(!1);return a.useEffect(()=>{if(!m)return;const s=d.current;if(!s)return;const r=new IntersectionObserver(x=>{const[c]=x;c.isIntersecting&&!o.current?(o.current=!0,i()):c.isIntersecting||(o.current=!1)},{rootMargin:l,threshold:n});return r.observe(s),()=>{s&&r.unobserve(s)}},[m,i,l,n]),d},W=()=>{const[i,m]=a.useState(""),l=I(),{products:n,loading:d,fetchProducts:o}=K(),{location:s,radiusKm:r,setRadiusKm:x,requestAutoLocation:c,loading:p,error:j}=R(),{stores:g,loading:L,fetchNearbyStores:N}=$(),[u,b]=a.useState(r),[P,C]=a.useState(!1),E=G({enabled:!!s,onIntersect:()=>C(!0)}),y=10;a.useEffect(()=>{s&&!L&&N(s,r)},[s,r,N]),a.useEffect(()=>{o(s?{promo_only:!0,limit:y,sort:S.DISCOUNT,unique_products:!0,lat:s.lat,lon:s.lon,radius_km:r}:{promo_only:!0,limit:y,sort:S.DISCOUNT,unique_products:!0})},[s,r,o]),a.useEffect(()=>{b(r)},[r]),a.useEffect(()=>{const t=window.setTimeout(()=>{u!==r&&x(u)},500);return()=>window.clearTimeout(t)},[u,r,x]);const v=n!=null&&n.items?n.items.filter(t=>{const h=t.price.promo_price_nzd;return h!=null&&h<t.price.price_nzd}).map(t=>({...t,discountPercent:(t.price.price_nzd-(t.price.promo_price_nzd||0))/t.price.price_nzd*100})).sort((t,h)=>h.discountPercent-t.discountPercent).slice(0,10):[],w=()=>{const t=i.trim();l(t?`/explore?q=${encodeURIComponent(t)}`:"/explore")},_=()=>{l("/explore?promo_only=true")};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("section",{className:"bg-primary",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-16 md:py-20 text-center",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-semibold text-white mb-3 tracking-tight",children:"Compare grocery prices across NZ"}),e.jsx("p",{className:"text-base text-white/80 mb-8 max-w-lg mx-auto",children:"Find the best deals from major supermarkets near you"}),e.jsxs("div",{className:"relative max-w-xl mx-auto",children:[e.jsx(B,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(O,{placeholder:"Search for milk, bread, chicken...",value:i,onChange:t=>m(t.target.value),onKeyDown:t=>t.key==="Enter"&&w(),className:"pl-12 pr-24 h-12 text-base rounded-lg border-0 bg-white text-foreground shadow-sm"}),e.jsx(f,{onClick:w,size:"sm",className:"absolute right-1.5 top-1/2 -translate-y-1/2 h-9",children:"Search"})]})]})}),e.jsxs("main",{className:"max-w-6xl mx-auto px-4",children:[e.jsxs("section",{className:"py-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground",children:s?"Deals Near You":"Top Deals"}),!s&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Enable location for personalized results"})]}),e.jsxs(f,{onClick:_,variant:"ghost",size:"sm",className:"text-primary",children:["View all",e.jsx(k,{className:"ml-1 h-4 w-4"})]})]}),e.jsx(z,{products:v,loading:d}),!d&&v.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No deals available"})})]}),e.jsx("section",{className:"py-12 border-t",children:e.jsxs("div",{className:"bg-primary/5 rounded-xl p-8 flex flex-col md:flex-row items-center gap-6",children:[e.jsx("div",{className:"flex-shrink-0 w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(U,{className:"h-7 w-7 text-primary"})}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-1",children:"Build Your Trolley"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Add your weekly shop and instantly see which nearby store is cheapest for your entire list."})]}),e.jsxs(f,{onClick:()=>l("/trolley"),className:"flex-shrink-0",children:["Start Shopping",e.jsx(k,{className:"ml-2 h-4 w-4"})]})]})}),e.jsxs("section",{className:"py-12 border-t",children:[!s&&e.jsxs("div",{className:"max-w-md mx-auto text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-lg bg-secondary mb-4",children:e.jsx(F,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Enable Location"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"See deals from stores in your area"}),e.jsx(f,{onClick:c,disabled:p,children:p?"Getting location...":"Enable Location"}),j&&e.jsx("p",{className:"text-destructive text-sm mt-4",children:j})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-secondary rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Search radius"}),e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[u," km"]})]}),e.jsx(D,{value:[u],onValueChange:t=>b(t[0]),min:1,max:10,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-2",children:[e.jsx("span",{children:"1 km"}),e.jsxs("span",{children:[g.length," stores"]}),e.jsx("span",{children:"10 km"})]})]}),e.jsx("div",{ref:E,className:"rounded-lg overflow-hidden border",children:P?e.jsx(T,{userLocation:s,stores:g,selectedStore:null,onStoreClick:()=>{},radiusKm:r}):e.jsx(A,{className:"h-[400px] border-none"})})]})]}),e.jsxs("section",{className:"py-12 border-t",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Transparent Pricing"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto",children:"Compare prices across major supermarkets in real-time"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 sm:gap-8 max-w-lg mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-semibold text-primary",children:"3"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Supermarkets"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-semibold text-primary",children:"Updated Daily"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Prices"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-semibold text-primary",children:"Free"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Always"})]})]})]})]})]})};export{W as Landing,W as default};
