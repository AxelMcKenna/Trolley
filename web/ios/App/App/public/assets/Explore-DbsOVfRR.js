import{j as e,a as Ae,C as Te,X as se,G as Me,b as Be,c as qe,D as De,d as Ie,e as ae,L as $e,N as O,M as ue,f as Ve,g as ze,E as Ue,h as Oe,m as B}from"./ui-vendor-DequXtLf.js";import{e as me,r as i,u as We}from"./react-vendor-M7dDMeuj.js";import{H as Ge}from"./Header-BTkoquYf.js";import{B as S,a as xe,u as pe,c as _,b as He,I as te,d as Ke,C as Qe}from"./input-C4EhYCMY.js";import{c as he,d as ge,e as fe,f as be,g as W,h as Xe,i as Ye,j as G,u as Ze,k as re,l as Je,m as es,D as ss,n as as,o as V,p as z,q as ne,S as oe,b as ts,a as rs,P as ns,C as os}from"./ComparisonTray-ClzrLXdo.js";import{u as H,t as le,a as ls}from"./index-BZiTwUF9.js";var k=(s=>(s.BEST_VALUE="price_per_100ml",s.CHEAPEST="total_price",s.BEST_PER_DRINK="price_per_standard_drink",s.DISTANCE="distance",s.NEWEST="newest",s))(k||{});const K=()=>{const[s,a]=me(),t=i.useMemo(()=>{const o=s.get("q")||void 0,d=s.get("category")||void 0,x=s.get("chain"),p=x?x.split(","):void 0,f=s.get("promo_only")==="true"?!0:void 0,h=s.get("price_min")?parseFloat(s.get("price_min")):void 0,l=s.get("price_max")?parseFloat(s.get("price_max")):void 0,g=s.get("sort")||k.BEST_VALUE,m=s.get("store_ids"),y=m?m.split(","):void 0;return{query:o,category:d,chains:p,promo_only:f,price_min:h,price_max:l,sort:g,store_ids:y}},[s]),n=i.useCallback(o=>{const d=new URLSearchParams(s);Object.entries(o).forEach(([x,p])=>{p==null||p===""?d.delete(x):x==="chains"&&Array.isArray(p)?p.length===0?d.delete("chain"):d.set("chain",p.join(",")):x==="store_ids"&&Array.isArray(p)?p.length===0?d.delete("store_ids"):d.set("store_ids",p.join(",")):x==="promo_only"?p?d.set("promo_only","true"):d.delete("promo_only"):d.set(x,String(p))}),a(d)},[s,a]),c=i.useCallback(()=>{a({})},[a]),r=i.useMemo(()=>{var o;return!!(t.query||t.category||(o=t.chains)!=null&&o.length||t.promo_only||t.price_min||t.price_max||t.sort&&t.sort!==k.BEST_VALUE)},[t]),u=i.useMemo(()=>{var d;let o=0;return t.category&&o++,(d=t.chains)!=null&&d.length&&(o+=t.chains.length),t.promo_only&&o++,(t.price_min||t.price_max)&&o++,t.sort&&t.sort!==k.BEST_VALUE&&o++,o},[t]);return{filters:t,updateFilters:n,clearFilters:c,hasActiveFilters:r,activeFilterCount:u}},is=({onOpenFilters:s})=>{const{activeFilterCount:a}=K();return e.jsx("div",{className:"bg-white border-b border-subtle lg:hidden",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:e.jsxs(S,{variant:"outline",onClick:s,className:"flex items-center gap-2 border-subtle",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Filters",a>0&&e.jsx(xe,{className:"bg-primary text-white ml-1",children:a})]})})})},cs=[{value:k.BEST_VALUE,label:"Best Value (per 100ml)"},{value:k.CHEAPEST,label:"Cheapest"},{value:k.BEST_PER_DRINK,label:"Best per Drink"},{value:k.DISTANCE,label:"Nearest Store"},{value:k.NEWEST,label:"Newest"}],ds=({value:s,onChange:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"sort",className:"text-sm font-medium text-foreground whitespace-nowrap",children:"Sort by:"}),e.jsxs(he,{value:s,onValueChange:a,children:[e.jsx(ge,{id:"sort",className:"w-[200px]",children:e.jsx(fe,{})}),e.jsx(be,{children:cs.map(t=>e.jsx(W,{value:t.value,children:t.label},t.value))})]})]}),us=[{value:"beer",label:"All Beer",group:"Beer"},{value:"lager",label:"Lager",group:"Beer"},{value:"ale",label:"Ale",group:"Beer"},{value:"ipa",label:"IPA",group:"Beer"},{value:"stout",label:"Stout",group:"Beer"},{value:"craft_beer",label:"Craft Beer",group:"Beer"},{value:"wine",label:"All Wine",group:"Wine"},{value:"red_wine",label:"Red Wine",group:"Wine"},{value:"white_wine",label:"White Wine",group:"Wine"},{value:"rose",label:"Rosé",group:"Wine"},{value:"sparkling",label:"Sparkling Wine",group:"Wine"},{value:"champagne",label:"Champagne",group:"Wine"},{value:"spirits",label:"All Spirits",group:"Spirits"},{value:"vodka",label:"Vodka",group:"Spirits"},{value:"gin",label:"Gin",group:"Spirits"},{value:"rum",label:"Rum",group:"Spirits"},{value:"whisky",label:"Whisky",group:"Spirits"},{value:"bourbon",label:"Bourbon",group:"Spirits"},{value:"scotch",label:"Scotch",group:"Spirits"},{value:"tequila",label:"Tequila",group:"Spirits"},{value:"brandy",label:"Brandy",group:"Spirits"},{value:"liqueur",label:"Liqueur",group:"Spirits"},{value:"rtd",label:"RTD (Ready to Drink)",group:"Other"},{value:"cider",label:"Cider",group:"Other"},{value:"mixer",label:"Mixers",group:"Other"},{value:"non_alcoholic",label:"Non-Alcoholic",group:"Other"}],ms=us.reduce((s,a)=>(s[a.group]||(s[a.group]=[]),s[a.group].push(a),s),{}),xs=({value:s,onChange:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"category",className:"text-sm font-medium text-foreground whitespace-nowrap",children:"Category:"}),e.jsxs(he,{value:s||"all",onValueChange:t=>a(t==="all"?void 0:t),children:[e.jsx(ge,{id:"category",className:"w-[180px]",children:e.jsx(fe,{placeholder:"All Categories"})}),e.jsxs(be,{children:[e.jsx(W,{value:"all",children:"All Categories"}),Object.entries(ms).map(([t,n])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-muted-foreground",children:t}),n.map(c=>e.jsx(W,{value:c.value,children:c.label},c.value))]},t))]})]})]});var D="Checkbox",[ps]=Xe(D),[hs,Q]=ps(D);function gs(s){const{__scopeCheckbox:a,checked:t,children:n,defaultChecked:c,disabled:r,form:u,name:o,onCheckedChange:d,required:x,value:p="on",internal_do_not_use_render:f}=s,[h,l]=Ze({prop:t,defaultProp:c??!1,onChange:d,caller:D}),[g,m]=i.useState(null),[y,b]=i.useState(null),C=i.useRef(!1),j=g?!!u||!!g.closest("form"):!0,w={checked:h,disabled:r,setChecked:l,control:g,setControl:m,name:o,form:u,value:p,hasConsumerStoppedPropagationRef:C,required:x,defaultChecked:E(c)?!1:c,isFormControl:j,bubbleInput:y,setBubbleInput:b};return e.jsx(hs,{scope:a,...w,children:fs(f)?f(w):n})}var je="CheckboxTrigger",ve=i.forwardRef(({__scopeCheckbox:s,onKeyDown:a,onClick:t,...n},c)=>{const{control:r,value:u,disabled:o,checked:d,required:x,setControl:p,setChecked:f,hasConsumerStoppedPropagationRef:h,isFormControl:l,bubbleInput:g}=Q(je,s),m=pe(c,p),y=i.useRef(d);return i.useEffect(()=>{const b=r==null?void 0:r.form;if(b){const C=()=>f(y.current);return b.addEventListener("reset",C),()=>b.removeEventListener("reset",C)}},[r,f]),e.jsx(G.button,{type:"button",role:"checkbox","aria-checked":E(d)?"mixed":d,"aria-required":x,"data-state":Se(d),"data-disabled":o?"":void 0,disabled:o,value:u,...n,ref:m,onKeyDown:re(a,b=>{b.key==="Enter"&&b.preventDefault()}),onClick:re(t,b=>{f(C=>E(C)?!0:!C),g&&l&&(h.current=b.isPropagationStopped(),h.current||b.stopPropagation())})})});ve.displayName=je;var X=i.forwardRef((s,a)=>{const{__scopeCheckbox:t,name:n,checked:c,defaultChecked:r,required:u,disabled:o,value:d,onCheckedChange:x,form:p,...f}=s;return e.jsx(gs,{__scopeCheckbox:t,checked:c,defaultChecked:r,disabled:o,required:u,onCheckedChange:x,name:n,form:p,value:d,internal_do_not_use_render:({isFormControl:h})=>e.jsxs(e.Fragment,{children:[e.jsx(ve,{...f,ref:a,__scopeCheckbox:t}),h&&e.jsx(we,{__scopeCheckbox:t})]})})});X.displayName=D;var ye="CheckboxIndicator",Ne=i.forwardRef((s,a)=>{const{__scopeCheckbox:t,forceMount:n,...c}=s,r=Q(ye,t);return e.jsx(Ye,{present:n||E(r.checked)||r.checked===!0,children:e.jsx(G.span,{"data-state":Se(r.checked),"data-disabled":r.disabled?"":void 0,...c,ref:a,style:{pointerEvents:"none",...s.style}})})});Ne.displayName=ye;var Ce="CheckboxBubbleInput",we=i.forwardRef(({__scopeCheckbox:s,...a},t)=>{const{control:n,hasConsumerStoppedPropagationRef:c,checked:r,defaultChecked:u,required:o,disabled:d,name:x,value:p,form:f,bubbleInput:h,setBubbleInput:l}=Q(Ce,s),g=pe(t,l),m=Je(r),y=es(n);i.useEffect(()=>{const C=h;if(!C)return;const j=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(j,"checked").set,R=!c.current;if(m!==r&&L){const P=new Event("click",{bubbles:R});C.indeterminate=E(r),L.call(C,E(r)?!1:r),C.dispatchEvent(P)}},[h,m,r,c]);const b=i.useRef(E(r)?!1:r);return e.jsx(G.input,{type:"checkbox","aria-hidden":!0,defaultChecked:u??b.current,required:o,disabled:d,name:x,value:p,form:f,...a,tabIndex:-1,ref:g,style:{...a.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});we.displayName=Ce;function fs(s){return typeof s=="function"}function E(s){return s==="indeterminate"}function Se(s){return E(s)?"indeterminate":s?"checked":"unchecked"}const Y=i.forwardRef(({className:s,...a},t)=>e.jsx(X,{ref:t,className:_("peer h-4 w-4 shrink-0 rounded-sm border border-gray-300 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 data-[state=checked]:text-white",s),...a,children:e.jsx(Ne,{className:_("flex items-center justify-center text-current"),children:e.jsx(Te,{className:"h-3 w-3"})})}));Y.displayName=X.displayName;var bs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],js=bs.reduce((s,a)=>{const t=He(`Primitive.${a}`),n=i.forwardRef((c,r)=>{const{asChild:u,...o}=c,d=u?t:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(d,{...o,ref:r})});return n.displayName=`Primitive.${a}`,{...s,[a]:n}},{}),vs="Label",ke=i.forwardRef((s,a)=>e.jsx(js.label,{...s,ref:a,onMouseDown:t=>{var c;t.target.closest("button, input, select, textarea")||((c=s.onMouseDown)==null||c.call(s,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));ke.displayName=vs;var _e=ke;const Z=i.forwardRef(({className:s,...a},t)=>e.jsx(_e,{ref:t,className:_("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",s),...a}));Z.displayName=_e.displayName;const ie=[{value:"countdown",label:"Countdown"},{value:"liquorland",label:"Liquorland"},{value:"liquor_centre",label:"Liquor Centre"},{value:"super_liquor",label:"Super Liquor"},{value:"bottle_o",label:"The Bottle-O"},{value:"new_world",label:"New World"},{value:"paknsave",label:"Pak'nSave"},{value:"glengarry",label:"Glengarry"},{value:"thirsty_liquor",label:"Thirsty Liquor"},{value:"black_bull",label:"Black Bull"}],ys=({selected:s,onChange:a})=>{const t=r=>{const u=s.includes(r)?s.filter(o=>o!==r):[...s,r];a(u)},n=()=>{a(ie.map(r=>r.value))},c=()=>{a([])};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Chains"}),e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsx("button",{onClick:n,className:"text-primary hover:text-accent transition-colors",children:"Select All"}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground",children:"|"}),e.jsx("button",{onClick:c,className:"text-muted-foreground hover:text-foreground transition-colors",children:"Clear"})]})]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 pr-2",children:ie.map(r=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:r.value,checked:s.includes(r.value),onCheckedChange:()=>t(r.value)}),e.jsx(Z,{htmlFor:r.value,className:"text-sm font-normal cursor-pointer",children:r.label})]},r.value))})]})},Ns=({checked:s,onChange:a})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:"promo-only",checked:s,onCheckedChange:t=>a(t===!0)}),e.jsx(Z,{htmlFor:"promo-only",className:"text-sm font-medium cursor-pointer",children:"Promo items only"})]}),Cs=({min:s,max:a,onChange:t})=>{const[n,c]=i.useState((s==null?void 0:s.toString())??""),[r,u]=i.useState((a==null?void 0:a.toString())??"");return i.useEffect(()=>{c((s==null?void 0:s.toString())??"")},[s]),i.useEffect(()=>{u((a==null?void 0:a.toString())??"")},[a]),i.useEffect(()=>{const o=setTimeout(()=>{const d=n?parseFloat(n):void 0,x=r?parseFloat(r):void 0;(d!==s||x!==a)&&t(d,x)},500);return()=>clearTimeout(o)},[n,r]),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground",children:"Price Range"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{type:"number",placeholder:"Min",value:n,onChange:o=>c(o.target.value),className:"w-24",min:"0",step:"0.01"}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx(te,{type:"number",placeholder:"Max",value:r,onChange:o=>u(o.target.value),className:"w-24",min:"0",step:"0.01"})]})]})},ws=({isOpen:s,onClose:a})=>{const{filters:t,updateFilters:n,clearFilters:c,activeFilterCount:r}=K();return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-40 lg:hidden",onClick:a}),e.jsx("aside",{className:`
          fixed lg:sticky lg:top-0 left-0 h-screen lg:max-h-screen w-72 bg-white
          transform transition-all duration-300 ease-out z-50
          ${s?"translate-x-0 shadow-xl lg:shadow-none":"-translate-x-full"}
          border-r border-border/40 lg:self-start
        `,children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-border/40",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-primary-gray tracking-tight",children:"Filters"}),r>0&&e.jsx(xe,{className:"bg-primary/10 text-primary border-primary/20 text-xs px-2",children:r})]}),e.jsx(S,{variant:"ghost",size:"icon",onClick:a,className:"lg:hidden -mr-2 hover:bg-gray-100 rounded-lg",children:e.jsx(se,{className:"h-4 w-4"})})]}),r>0&&e.jsxs(S,{variant:"ghost",size:"sm",onClick:c,className:"w-full justify-start text-secondary-gray hover:text-primary-gray hover:bg-gray-50 rounded-lg -ml-2",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Clear all filters"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Me,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Category"})]}),e.jsx(xs,{value:t.category,onChange:u=>n({category:u})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Be,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Sort By"})]}),e.jsx(ds,{value:t.sort||k.BEST_VALUE,onChange:u=>n({sort:u})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(qe,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Deals & Promos"})]}),e.jsx(Ns,{checked:t.promo_only||!1,onChange:u=>n({promo_only:u})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(De,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Price Range"})]}),e.jsx(Cs,{min:t.price_min,max:t.price_max,onChange:(u,o)=>n({price_min:u,price_max:o})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ie,{className:"h-4 w-4 text-primary"}),e.jsx("label",{className:"text-sm font-semibold text-primary-gray",children:"Stores"})]}),e.jsx(ys,{selected:t.chains||[],onChange:u=>n({chains:u})})]})]})]})})]})};async function ce(s){try{const a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s.lat}&lon=${s.lon}&zoom=14&addressdetails=1`,{headers:{"User-Agent":"Liquorfy/1.0"}});if(!a.ok)return console.error("Reverse geocoding failed:",a.statusText),null;const t=await a.json();if(!t||t.error)return console.error("Reverse geocoding error:",t==null?void 0:t.error),null;const n=t.address||{},c=n.suburb||n.neighbourhood||n.hamlet,r=n.city||n.town||n.village||n.municipality,u=n.state||n.region,o=[c,r,u].filter(Boolean);return{address:o.length>0?o.join(", "):t.display_name,suburb:c,city:r,region:u}}catch(a){return console.error("Error reverse geocoding:",a),null}}function de(s,a){return s?s.address:`${a.lat.toFixed(4)}, ${a.lon.toFixed(4)}`}const Ss=()=>{const{location:s,radiusKm:a,loading:t,error:n,isLocationModalOpen:c,closeLocationModal:r,requestAutoLocation:u,setManualLocation:o,setRadiusKm:d,isLocationSet:x}=H(),[p,f]=i.useState("initial"),[h,l]=i.useState(a),[g,m]=i.useState(s),[y,b]=i.useState("");i.useEffect(()=>{c&&(x&&s?(f("auto-success"),m(s),l(a)):(f("initial"),l(a)))},[c,x,s,a]),i.useEffect(()=>{s&&ce(s).then(N=>{b(N?de(N,s):`${s.lat.toFixed(4)}, ${s.lon.toFixed(4)}`)})},[s]);const C=async()=>{try{await u(),f("auto-success")}catch{f("manual-map")}},j=()=>{f("manual-map"),g||m({lat:-41.2924,lon:174.7787})},w=async(N,F)=>{m({lat:N,lon:F});const M=await ce({lat:N,lon:F});b(M?de(M,{lat:N,lon:F}):`${N.toFixed(4)}, ${F.toFixed(4)}`)},L=()=>{g&&(o(g.lat,g.lon,h),r(),le.success("Location set",{description:`Finding products within ${h}km`,duration:3e3}))},R=()=>{d(h),r(),le.success("Location updated",{description:`Search radius set to ${h}km`,duration:3e3})},P=x;return e.jsx(ss,{open:c,onOpenChange:P?r:void 0,children:e.jsxs(as,{className:`sm:max-w-[600px] ${P?"":"[&>button]:hidden"}`,onPointerDownOutside:N=>!P&&N.preventDefault(),onEscapeKeyDown:N=>!P&&N.preventDefault(),children:[p==="initial"&&e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(z,{children:"Set Your Location"}),e.jsx(ne,{children:"To show you products from nearby stores, we need your location."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[n&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(ae,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:n})]}),e.jsx(S,{onClick:C,disabled:t,className:"w-full h-14 text-lg",size:"lg",children:t?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-5 h-5 mr-2 animate-spin"}),"Getting location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-5 h-5 mr-2"}),"Use My Location"]})}),e.jsxs(S,{onClick:j,variant:"outline",className:"w-full h-14 text-lg",size:"lg",disabled:t,children:[e.jsx(ue,{className:"w-5 h-5 mr-2"}),"Set Location on Map"]})]})]}),p==="auto-success"&&s&&e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-6 h-6 text-green-600"}),"Location Set"]})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"Using your current location"}),e.jsx("p",{className:"text-sm font-medium text-green-900",children:y||"Loading address..."}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[s.lat.toFixed(4),", ",s.lon.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Search Radius: ",h,"km"]}),e.jsx(oe,{value:[h],onValueChange:N=>l(N[0]),min:5,max:50,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"5km"}),e.jsx("span",{children:"50km"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:()=>f("manual-map"),className:"flex-1",children:"Adjust Manually"}),e.jsx(S,{onClick:R,className:"flex-1",children:"Continue"})]})]})]}),p==="manual-map"&&e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(z,{children:"Set Location on Map"}),e.jsx(ne,{children:"Drag the pin to your approximate location"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[n&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(ae,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:n})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden h-[400px]",children:e.jsx(ts,{userLocation:g||{lat:-41.2924,lon:174.7787},stores:[],onLocationChange:w,isDraggable:!0,radiusKm:h})}),g&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-primary-gray",children:y||"Loading address..."}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[g.lat.toFixed(4),", ",g.lon.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Search Radius: ",h,"km"]}),e.jsx(oe,{value:[h],onValueChange:N=>l(N[0]),min:5,max:50,step:1,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"5km"}),e.jsx("span",{children:"50km"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"outline",onClick:()=>f("initial"),className:"flex-1",children:"Back"}),e.jsx(S,{onClick:L,className:"flex-1",children:"Confirm Location"})]})]})]})]})})},ks=({children:s})=>{const{isLocationSet:a,openLocationModal:t}=H();return i.useEffect(()=>{a||t()},[a,t]),e.jsxs(e.Fragment,{children:[e.jsx(Ss,{}),s]})},_s="http://localhost:8000",U=24,Ps=()=>{const[s,a]=i.useState([]),[t,n]=i.useState(0),[c,r]=i.useState(!1),[u,o]=i.useState(null),[d,x]=i.useState(1),p=Math.ceil(t/U),f=i.useCallback(async(l,g=1)=>{r(!0),o(null),x(g);try{const m=new URLSearchParams;l.query&&m.append("q",l.query),l.category&&m.append("category",l.category),l.chains&&l.chains.length>0&&m.append("chain",l.chains.join(",")),l.store_ids&&l.store_ids.length>0&&m.append("store",l.store_ids.join(",")),l.promo_only&&m.append("promo_only","true"),l.price_min!==void 0&&m.append("price_min",l.price_min.toString()),l.price_max!==void 0&&m.append("price_max",l.price_max.toString()),l.sort&&m.append("sort",l.sort),l.lat!==void 0&&m.append("lat",l.lat.toString()),l.lon!==void 0&&m.append("lon",l.lon.toString()),l.radius_km!==void 0&&m.append("radius_km",l.radius_km.toString()),m.append("page_size",U.toString()),m.append("page",g.toString());const{data:y}=await rs.get(`${_s}/products`,{params:m});a(y.items),n(y.total)}catch{o("Failed to load products"),a([]),n(0)}finally{r(!1)}},[]),h=i.useCallback(l=>{l>=1&&l<=p&&(x(l),window.scrollTo({top:0,behavior:"smooth"}))},[p]);return{products:s,total:t,loading:c,error:u,currentPage:d,totalPages:p,pageSize:U,fetchProducts:f,goToPage:h}},Es=({className:s,...a})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:_("mx-auto flex w-full justify-center",s),...a}),Ls=({className:s,...a})=>e.jsx("ul",{className:_("flex flex-row items-center gap-1",s),...a}),q=({className:s,...a})=>e.jsx("li",{className:_("",s),...a}),J=({className:s,isActive:a,size:t="icon",...n})=>e.jsx("a",{"aria-current":a?"page":void 0,className:_(Ke({variant:a?"default":"outline",size:t}),"cursor-pointer",s),...n}),Fs=({className:s,...a})=>e.jsxs(J,{"aria-label":"Go to previous page",size:"default",className:_("gap-1 pl-2.5",s),...a,children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]}),Rs=({className:s,...a})=>e.jsxs(J,{"aria-label":"Go to next page",size:"default",className:_("gap-1 pr-2.5",s),...a,children:[e.jsx("span",{children:"Next"}),e.jsx(Oe,{className:"h-4 w-4"})]}),As=({className:s,...a})=>e.jsxs("span",{"aria-hidden":!0,className:_("flex h-9 w-9 items-center justify-center",s),...a,children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"More pages"})]}),$s=()=>{const s=We(),[a,t]=me(),[n,c]=i.useState(""),[r,u]=i.useState(!0),{location:o,radiusKm:d,isLocationSet:x,openLocationModal:p,requestAutoLocation:f,loading:h,error:l}=H(),{filters:g}=K(),{products:m,total:y,loading:b,error:C,currentPage:j,totalPages:w,fetchProducts:L,goToPage:R}=Ps(),{compare:P,sortedCompare:N,toggleCompare:F,clearCompare:M,isAtLimit:Pe,maxCompare:Ee}=ls(),ee=parseInt(a.get("page")||"1",10);i.useEffect(()=>{c(g.query||"")},[g.query]),i.useEffect(()=>{if(!o||!x)return;const v={...g,lat:o.lat,lon:o.lon,radius_km:d};L(v,ee)},[g,o,d,ee,x,L]);const I=v=>{const A=new URLSearchParams(a);A.set("page",v.toString()),t(A),R(v)},Le=()=>{const v=[];if(w<=7)for(let T=1;T<=w;T++)v.push(T);else{v.push(1),j>3&&v.push("ellipsis");const T=Math.max(2,j-1),Re=Math.min(w-1,j+1);for(let $=T;$<=Re;$++)v.push($);j<w-2&&v.push("ellipsis"),v.push(w)}return v},Fe=()=>{n.trim()&&s(`/explore?q=${encodeURIComponent(n)}`)};return e.jsx(ks,{children:e.jsxs("div",{className:"min-h-screen bg-secondary",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-secondary",children:[e.jsx(Ge,{query:n,setQuery:c,onSearch:Fe,variant:"compact"}),e.jsx(is,{onOpenFilters:()=>u(!0)})]}),e.jsxs("div",{className:"flex",children:[e.jsx(ws,{isOpen:r,onClose:()=>u(!1)}),e.jsx("main",{className:"flex-1 overflow-y-auto min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pb-32",children:[!x&&e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs(Qe,{className:"glass-card p-12 text-center max-w-lg",children:[e.jsx("div",{className:"inline-block p-6 bg-primary/10 rounded-full mb-6",children:e.jsx(O,{className:"h-16 w-16 text-primary"})}),e.jsx("h2",{className:"text-3xl font-semibold mb-4 text-primary-gray",children:"Location Required"}),e.jsx("p",{className:"text-lg mb-2 text-secondary-gray",children:"To provide you with accurate pricing and availability, we need to know your location."}),e.jsx("p",{className:"text-base mb-8 text-tertiary-gray",children:"This helps us show you products from stores in your area and prevents excessive database queries."}),l&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:l})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{onClick:f,disabled:h,size:"lg",className:"w-full bg-primary hover:bg-accent text-white px-10 py-6 text-base font-medium rounded-card-xl",children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"}),"Getting Location..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-5 w-5 mr-2"}),"Use My Location"]})}),e.jsxs(S,{onClick:p,variant:"outline",size:"lg",className:"w-full rounded-card-xl font-medium border-subtle text-primary-gray py-6",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Set Location Manually"]})]})]})}),x&&e.jsxs(e.Fragment,{children:[C&&e.jsx(B.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"glass border-destructive/30 rounded-xl p-6 mb-6",children:e.jsx("p",{className:"text-destructive font-medium",children:C})}),!b&&m.length>0&&e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"mb-6 flex items-center justify-between",children:[e.jsx("p",{className:"text-muted-foreground text-lg",children:y===0?"No products found":`Showing ${(j-1)*24+1}-${Math.min(j*24,y)} of ${y} product${y===1?"":"s"}`}),e.jsxs("p",{className:"text-sm text-tertiary-gray",children:["Page ",j," of ",w]})]}),e.jsx(ns,{products:m,loading:b,compareIds:P.map(v=>v.id),onToggleCompare:F,isCompareAtLimit:Pe}),!b&&m.length>0&&w>1&&e.jsx("div",{className:"mt-8 mb-4",children:e.jsx(Es,{children:e.jsxs(Ls,{children:[e.jsx(q,{children:e.jsx(Fs,{onClick:()=>j>1&&I(j-1),className:j===1?"pointer-events-none opacity-50":""})}),Le().map((v,A)=>v==="ellipsis"?e.jsx(q,{children:e.jsx(As,{})},`ellipsis-${A}`):e.jsx(q,{children:e.jsx(J,{onClick:()=>I(v),isActive:j===v,children:v})},v)),e.jsx(q,{children:e.jsx(Rs,{onClick:()=>j<w&&I(j+1),className:j===w?"pointer-events-none opacity-50":""})})]})})}),!b&&m.length===0&&e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground text-lg",children:"No products found. Try adjusting your search or filters."})})]})]})})]}),e.jsx(os,{products:N,onClear:M,onRemoveProduct:F,maxCompare:Ee})]})})};export{$s as Explore,$s as default};
